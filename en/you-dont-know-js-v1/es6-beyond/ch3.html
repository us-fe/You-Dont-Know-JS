<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>You Don't Know JS: ES6 & Beyond | US-FE</title><meta name="description" content="US-FE eBoks">
    <link rel="modulepreload" href="/ebooks/assets/app.a957722f.js"><link rel="modulepreload" href="/ebooks/assets/ch3.html.ff25d27b.js"><link rel="modulepreload" href="/ebooks/assets/ch3.html.23176d66.js">
    <link rel="stylesheet" href="/ebooks/assets/style.6c500c23.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/ebooks/en/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt="US-FE"><span class="site-name can-hide">US-FE</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://us-fe.github.io" rel="noopener noreferrer" target="_blank" aria-label="US-FE"><!--[--><!--]--> US-FE <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/ebooks/" class="router-link-active" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="You Don&#39;t Know JS"><span class="title">You Don&#39;t Know JS</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="You Don&#39;t Know JS"><span class="title">You Don&#39;t Know JS</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>V1</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/up-going/" class="" aria-label="Up &amp; Going"><!--[--><!--]--> Up &amp; Going <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/" class="" aria-label="Scope &amp; Closures"><!--[--><!--]--> Scope &amp; Closures <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/" class="" aria-label="This &amp; Object Prototypes"><!--[--><!--]--> This &amp; Object Prototypes <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/" class="" aria-label="Types &amp; Grammar"><!--[--><!--]--> Types &amp; Grammar <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/async-performance/" class="" aria-label="Async &amp; Performance"><!--[--><!--]--> Async &amp; Performance <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/" class="router-link-active" aria-label="ES6 &amp; Beyond"><!--[--><!--]--> ES6 &amp; Beyond <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>V2</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v2/get-started/" class="" aria-label="Get Started"><!--[--><!--]--> Get Started <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v2/scope-closures/" class="" aria-label="Scope &amp; Closures"><!--[--><!--]--> Scope &amp; Closures <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Professional Javascript for Web Developers V4"><span class="title">Professional Javascript for Web Developers V4</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Professional Javascript for Web Developers V4"><span class="title">Professional Javascript for Web Developers V4</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch1-what-is-javascript" class="" aria-label="Chapter 1: What Is JavaScript?"><!--[--><!--]--> Chapter 1: What Is JavaScript? <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch2-javascript-in-html" class="" aria-label="Chapter 2: JavaScript in HTML"><!--[--><!--]--> Chapter 2: JavaScript in HTML <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch3-language-basics" class="" aria-label="Chapter 3: Language Basics"><!--[--><!--]--> Chapter 3: Language Basics <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch4-variables-scope-and-memory" class="" aria-label="Chapter 4: Variables, Scope, and Memory"><!--[--><!--]--> Chapter 4: Variables, Scope, and Memory <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch5-basic-reference-types" class="" aria-label="Chapter 5: Basic Reference Types"><!--[--><!--]--> Chapter 5: Basic Reference Types <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch6-collection-reference-types" class="" aria-label="Chapter 6: Collection Reference Types"><!--[--><!--]--> Chapter 6: Collection Reference Types <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch7-iterators-and-generators" class="" aria-label="Chapter 7: Iterators and Generators"><!--[--><!--]--> Chapter 7: Iterators and Generators <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch8-objects-classes-and-object-oriented-programming" class="" aria-label="Chapter 8: Objects, Classes, and Object-Oriented Programming"><!--[--><!--]--> Chapter 8: Objects, Classes, and Object-Oriented Programming <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch9-proxies-and-reflect" class="" aria-label="Chapter 9: Proxies and Reflect"><!--[--><!--]--> Chapter 9: Proxies and Reflect <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch10-funtions" class="" aria-label="Chapter 10: Functions"><!--[--><!--]--> Chapter 10: Functions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch11-promises-and-async-functions" class="" aria-label="Chapter 11: Promises and Async Functions"><!--[--><!--]--> Chapter 11: Promises and Async Functions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch12-the-browser-object-model" class="" aria-label="Chapter 12: The Browser Object Model"><!--[--><!--]--> Chapter 12: The Browser Object Model <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch13-client-detection" class="" aria-label="Chapter 13: Client Detection"><!--[--><!--]--> Chapter 13: Client Detection <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch14-the-document-object-model" class="" aria-label="Chapter 14: The Document Object Model"><!--[--><!--]--> Chapter 14: The Document Object Model <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch15-dom-extensions" class="" aria-label="Chapter 15: DOM Extensions"><!--[--><!--]--> Chapter 15: DOM Extensions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch16-dom-levels-2-and-3" class="" aria-label="Chapter 16: DOM Levels 2 and 3"><!--[--><!--]--> Chapter 16: DOM Levels 2 and 3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch17-events" class="" aria-label="Chapter 17: Events"><!--[--><!--]--> Chapter 17: Events <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch18-animation-and-graphics-with-canvas" class="" aria-label="Chapter 18: Animation and Graphics with Canvas"><!--[--><!--]--> Chapter 18: Animation and Graphics with Canvas <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch19-scripting-forms" class="" aria-label="Chapter 19: Scripting Forms"><!--[--><!--]--> Chapter 19: Scripting Forms <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch20-javascript-apis" class="" aria-label="Chapter 20: JavaScript APIs"><!--[--><!--]--> Chapter 20: JavaScript APIs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch21-error-handling-and-debugging" class="" aria-label="Chapter 21: Error Handling and Debugging"><!--[--><!--]--> Chapter 21: Error Handling and Debugging <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch22-xml-in-javascript" class="" aria-label="Chapter 22: XML in JavaScript"><!--[--><!--]--> Chapter 22: XML in JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch23-json" class="" aria-label="Chapter 23: JSON"><!--[--><!--]--> Chapter 23: JSON <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch24-network-requests-and-remote-resources" class="" aria-label="Chapter 24: Network Requests and Remote Resources"><!--[--><!--]--> Chapter 24: Network Requests and Remote Resources <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch25-client-side-storage" class="" aria-label="Chapter 25: Client-Side Storage"><!--[--><!--]--> Chapter 25: Client-Side Storage <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch26-modules" class="" aria-label="Chapter 26: Modules"><!--[--><!--]--> Chapter 26: Modules <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch27-workers" class="" aria-label="Chapter 27: Workers"><!--[--><!--]--> Chapter 27: Workers <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch28-best-practices" class="" aria-label="Chapter 28: Best Practices"><!--[--><!--]--> Chapter 28: Best Practices <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apA-es2018-and-es2019" class="" aria-label="Appendix A: ES2018 and ES2019"><!--[--><!--]--> Appendix A: ES2018 and ES2019 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apB-strct-mode" class="" aria-label="Appendix B: Strict Mode"><!--[--><!--]--> Appendix B: Strict Mode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apC-javascript-libraries-and-frameworks" class="" aria-label="Appendix C: JavaScript Libraries and Frameworks"><!--[--><!--]--> Appendix C: JavaScript Libraries and Frameworks <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apD-javascript-tools" class="" aria-label="Appendix D: JavasScript Tools"><!--[--><!--]--> Appendix D: JavasScript Tools <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/ebooks/zh/you-dont-know-js-v1/es6-beyond/ch3.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch3.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/us-fe/ebooks" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://us-fe.github.io" rel="noopener noreferrer" target="_blank" aria-label="US-FE"><!--[--><!--]--> US-FE <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/ebooks/" class="router-link-active" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="You Don&#39;t Know JS"><span class="title">You Don&#39;t Know JS</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="You Don&#39;t Know JS"><span class="title">You Don&#39;t Know JS</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>V1</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/up-going/" class="" aria-label="Up &amp; Going"><!--[--><!--]--> Up &amp; Going <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/" class="" aria-label="Scope &amp; Closures"><!--[--><!--]--> Scope &amp; Closures <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/" class="" aria-label="This &amp; Object Prototypes"><!--[--><!--]--> This &amp; Object Prototypes <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/" class="" aria-label="Types &amp; Grammar"><!--[--><!--]--> Types &amp; Grammar <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/async-performance/" class="" aria-label="Async &amp; Performance"><!--[--><!--]--> Async &amp; Performance <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/" class="router-link-active" aria-label="ES6 &amp; Beyond"><!--[--><!--]--> ES6 &amp; Beyond <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>V2</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v2/get-started/" class="" aria-label="Get Started"><!--[--><!--]--> Get Started <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ebooks/en/you-dont-know-js-v2/scope-closures/" class="" aria-label="Scope &amp; Closures"><!--[--><!--]--> Scope &amp; Closures <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Professional Javascript for Web Developers V4"><span class="title">Professional Javascript for Web Developers V4</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Professional Javascript for Web Developers V4"><span class="title">Professional Javascript for Web Developers V4</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch1-what-is-javascript" class="" aria-label="Chapter 1: What Is JavaScript?"><!--[--><!--]--> Chapter 1: What Is JavaScript? <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch2-javascript-in-html" class="" aria-label="Chapter 2: JavaScript in HTML"><!--[--><!--]--> Chapter 2: JavaScript in HTML <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch3-language-basics" class="" aria-label="Chapter 3: Language Basics"><!--[--><!--]--> Chapter 3: Language Basics <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch4-variables-scope-and-memory" class="" aria-label="Chapter 4: Variables, Scope, and Memory"><!--[--><!--]--> Chapter 4: Variables, Scope, and Memory <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch5-basic-reference-types" class="" aria-label="Chapter 5: Basic Reference Types"><!--[--><!--]--> Chapter 5: Basic Reference Types <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch6-collection-reference-types" class="" aria-label="Chapter 6: Collection Reference Types"><!--[--><!--]--> Chapter 6: Collection Reference Types <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch7-iterators-and-generators" class="" aria-label="Chapter 7: Iterators and Generators"><!--[--><!--]--> Chapter 7: Iterators and Generators <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch8-objects-classes-and-object-oriented-programming" class="" aria-label="Chapter 8: Objects, Classes, and Object-Oriented Programming"><!--[--><!--]--> Chapter 8: Objects, Classes, and Object-Oriented Programming <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch9-proxies-and-reflect" class="" aria-label="Chapter 9: Proxies and Reflect"><!--[--><!--]--> Chapter 9: Proxies and Reflect <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch10-funtions" class="" aria-label="Chapter 10: Functions"><!--[--><!--]--> Chapter 10: Functions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch11-promises-and-async-functions" class="" aria-label="Chapter 11: Promises and Async Functions"><!--[--><!--]--> Chapter 11: Promises and Async Functions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch12-the-browser-object-model" class="" aria-label="Chapter 12: The Browser Object Model"><!--[--><!--]--> Chapter 12: The Browser Object Model <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch13-client-detection" class="" aria-label="Chapter 13: Client Detection"><!--[--><!--]--> Chapter 13: Client Detection <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch14-the-document-object-model" class="" aria-label="Chapter 14: The Document Object Model"><!--[--><!--]--> Chapter 14: The Document Object Model <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch15-dom-extensions" class="" aria-label="Chapter 15: DOM Extensions"><!--[--><!--]--> Chapter 15: DOM Extensions <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch16-dom-levels-2-and-3" class="" aria-label="Chapter 16: DOM Levels 2 and 3"><!--[--><!--]--> Chapter 16: DOM Levels 2 and 3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch17-events" class="" aria-label="Chapter 17: Events"><!--[--><!--]--> Chapter 17: Events <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch18-animation-and-graphics-with-canvas" class="" aria-label="Chapter 18: Animation and Graphics with Canvas"><!--[--><!--]--> Chapter 18: Animation and Graphics with Canvas <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch19-scripting-forms" class="" aria-label="Chapter 19: Scripting Forms"><!--[--><!--]--> Chapter 19: Scripting Forms <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch20-javascript-apis" class="" aria-label="Chapter 20: JavaScript APIs"><!--[--><!--]--> Chapter 20: JavaScript APIs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch21-error-handling-and-debugging" class="" aria-label="Chapter 21: Error Handling and Debugging"><!--[--><!--]--> Chapter 21: Error Handling and Debugging <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch22-xml-in-javascript" class="" aria-label="Chapter 22: XML in JavaScript"><!--[--><!--]--> Chapter 22: XML in JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch23-json" class="" aria-label="Chapter 23: JSON"><!--[--><!--]--> Chapter 23: JSON <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch24-network-requests-and-remote-resources" class="" aria-label="Chapter 24: Network Requests and Remote Resources"><!--[--><!--]--> Chapter 24: Network Requests and Remote Resources <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch25-client-side-storage" class="" aria-label="Chapter 25: Client-Side Storage"><!--[--><!--]--> Chapter 25: Client-Side Storage <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch26-modules" class="" aria-label="Chapter 26: Modules"><!--[--><!--]--> Chapter 26: Modules <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch27-workers" class="" aria-label="Chapter 27: Workers"><!--[--><!--]--> Chapter 27: Workers <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/ch28-best-practices" class="" aria-label="Chapter 28: Best Practices"><!--[--><!--]--> Chapter 28: Best Practices <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apA-es2018-and-es2019" class="" aria-label="Appendix A: ES2018 and ES2019"><!--[--><!--]--> Appendix A: ES2018 and ES2019 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apB-strct-mode" class="" aria-label="Appendix B: Strict Mode"><!--[--><!--]--> Appendix B: Strict Mode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apC-javascript-libraries-and-frameworks" class="" aria-label="Appendix C: JavaScript Libraries and Frameworks"><!--[--><!--]--> Appendix C: JavaScript Libraries and Frameworks <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ebooks/en/professional-javascript-for-web-developers-v4/apD-javascript-tools" class="" aria-label="Appendix D: JavasScript Tools"><!--[--><!--]--> Appendix D: JavasScript Tools <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/ebooks/zh/you-dont-know-js-v1/es6-beyond/ch3.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch3.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/us-fe/ebooks" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Up &amp; Going <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/up-going/" class="sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/up-going/ch1" class="sidebar-item" aria-label="Chapter 1: Into Programming"><!--[--><!--]--> Chapter 1: Into Programming <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/up-going/ch2" class="sidebar-item" aria-label="Chapter 2: Into JavaScript"><!--[--><!--]--> Chapter 2: Into JavaScript <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/up-going/ch3" class="sidebar-item" aria-label="Chapter 3: Into YDKJS"><!--[--><!--]--> Chapter 3: Into YDKJS <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/up-going/apA" class="sidebar-item" aria-label="Appendix A: Acknowledgments"><!--[--><!--]--> Appendix A: Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Scope &amp; Closures <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/" class="sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/toc" class="sidebar-item" aria-label="TOC"><!--[--><!--]--> TOC <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/ch1" class="sidebar-item" aria-label="Chapter 1: What is Scope?"><!--[--><!--]--> Chapter 1: What is Scope? <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/ch2" class="sidebar-item" aria-label="Chapter 2: Lexical Scope"><!--[--><!--]--> Chapter 2: Lexical Scope <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/ch3" class="sidebar-item" aria-label="Chapter 3: Function vs. Block Scope"><!--[--><!--]--> Chapter 3: Function vs. Block Scope <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/ch4" class="sidebar-item" aria-label="Chapter 4: Hoisting"><!--[--><!--]--> Chapter 4: Hoisting <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/ch5" class="sidebar-item" aria-label="Chapter 5: Scope Closure"><!--[--><!--]--> Chapter 5: Scope Closure <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/apA" class="sidebar-item" aria-label="Appendix A: Dynamic Scope"><!--[--><!--]--> Appendix A: Dynamic Scope <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/apB" class="sidebar-item" aria-label="Appendix B: Polyfilling Block Scope"><!--[--><!--]--> Appendix B: Polyfilling Block Scope <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/apC" class="sidebar-item" aria-label="Appendix C: Lexical-this"><!--[--><!--]--> Appendix C: Lexical-this <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/scope-closures/apD" class="sidebar-item" aria-label="Appendix D: Acknowledgments"><!--[--><!--]--> Appendix D: Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">This &amp; Object Prototypes <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/" class="sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/toc" class="sidebar-item" aria-label="TOC"><!--[--><!--]--> TOC <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch1" class="sidebar-item" aria-label="Chapter 1: `this` Or That?"><!--[--><!--]--> Chapter 1: `this` Or That? <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch2" class="sidebar-item" aria-label="Chapter 2: `this` All Makes Sense Now!"><!--[--><!--]--> Chapter 2: `this` All Makes Sense Now! <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch3" class="sidebar-item" aria-label="Chapter 3: Objects"><!--[--><!--]--> Chapter 3: Objects <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch4" class="sidebar-item" aria-label="Chapter 4: Mixing (Up) &quot;Class&quot; Objects"><!--[--><!--]--> Chapter 4: Mixing (Up) &quot;Class&quot; Objects <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch5" class="sidebar-item" aria-label="Chapter 5: Prototypes"><!--[--><!--]--> Chapter 5: Prototypes <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/ch3" class="sidebar-item" aria-label="Chapter 6: Behavior Delegation"><!--[--><!--]--> Chapter 6: Behavior Delegation <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/apA" class="sidebar-item" aria-label="Appendix A: Acknowledgments"><!--[--><!--]--> Appendix A: Acknowledgments <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/this-object-prototypes/apB" class="sidebar-item" aria-label="Appendix A: Acknowledgments"><!--[--><!--]--> Appendix A: Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Types &amp; Grammar <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/" class="sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/toc" class="sidebar-item" aria-label="TOC"><!--[--><!--]--> TOC <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/ch1" class="sidebar-item" aria-label="Chapter 1: Types"><!--[--><!--]--> Chapter 1: Types <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/ch2" class="sidebar-item" aria-label="Chapter 2: Values"><!--[--><!--]--> Chapter 2: Values <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/ch3" class="sidebar-item" aria-label="Chapter 3: Natives"><!--[--><!--]--> Chapter 3: Natives <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/ch4" class="sidebar-item" aria-label="Chapter 4: Coercion"><!--[--><!--]--> Chapter 4: Coercion <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/ch5" class="sidebar-item" aria-label="Chapter 5: Grammar"><!--[--><!--]--> Chapter 5: Grammar <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/types-grammar/apA" class="sidebar-item" aria-label="Appendix A: Mixed Environment JavaScript"><!--[--><!--]--> Appendix A: Mixed Environment JavaScript <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Async &amp; Performance <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/" class="sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/toc" class="sidebar-item" aria-label="TOC"><!--[--><!--]--> TOC <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch1" class="sidebar-item" aria-label="Chapter 1: Asynchrony: Now &amp; Later"><!--[--><!--]--> Chapter 1: Asynchrony: Now &amp; Later <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch2" class="sidebar-item" aria-label="Chapter 2: Callbacks"><!--[--><!--]--> Chapter 2: Callbacks <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch3" class="sidebar-item" aria-label="Chapter 3: Promises"><!--[--><!--]--> Chapter 3: Promises <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch4" class="sidebar-item" aria-label="Chapter 4: Generators"><!--[--><!--]--> Chapter 4: Generators <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch5" class="sidebar-item" aria-label="Chapter 5: Program Performance"><!--[--><!--]--> Chapter 5: Program Performance <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/ch6" class="sidebar-item" aria-label="Chapter 6: Benchmarking &amp; Tuning"><!--[--><!--]--> Chapter 6: Benchmarking &amp; Tuning <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/async-performance/apA" class="sidebar-item" aria-label="Appendix A: *asynquence* Library"><!--[--><!--]--> Appendix A: *asynquence* Library <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">ES6 &amp; Beyond <span class="down arrow"></span></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/" class="router-link-active sidebar-item" aria-label="README"><!--[--><!--]--> README <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/toc" class="sidebar-item" aria-label="TOC"><!--[--><!--]--> TOC <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch1" class="sidebar-item" aria-label="Chapter 1: ES? Now &amp; Future"><!--[--><!--]--> Chapter 1: ES? Now &amp; Future <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch2" class="sidebar-item" aria-label="Chapter 2: Syntax"><!--[--><!--]--> Chapter 2: Syntax <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch3" class="router-link-active sidebar-item active" aria-label="Chapter 3: Organization"><!--[--><!--]--> Chapter 3: Organization <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch4" class="sidebar-item" aria-label="Chapter 4: Async Flow Control"><!--[--><!--]--> Chapter 4: Async Flow Control <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch5" class="sidebar-item" aria-label="Chapter 5: Collections"><!--[--><!--]--> Chapter 5: Collections <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch6" class="sidebar-item" aria-label="Chapter 6: API Additions"><!--[--><!--]--> Chapter 6: API Additions <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch7" class="sidebar-item" aria-label="Chapter 7: Meta Programming"><!--[--><!--]--> Chapter 7: Meta Programming <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/ch8" class="sidebar-item" aria-label="Chapter 8: Beyond ES6"><!--[--><!--]--> Chapter 8: Beyond ES6 <!--[--><!--]--></a><!----></li><li><a href="/ebooks/en/you-dont-know-js-v1/es6-beyond/apA" class="sidebar-item" aria-label="Appendix A: Acknowledgments"><!--[--><!--]--> Appendix A: Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="you-don-t-know-js-es6-beyond" tabindex="-1"><a class="header-anchor" href="#you-don-t-know-js-es6-beyond" aria-hidden="true">#</a> You Don&#39;t Know JS: ES6 &amp; Beyond</h1><h1 id="chapter-3-organization" tabindex="-1"><a class="header-anchor" href="#chapter-3-organization" aria-hidden="true">#</a> Chapter 3: Organization</h1><p>It&#39;s one thing to write JS code, but it&#39;s another to properly organize it. Utilizing common patterns for organization and reuse goes a long way to improving the readability and understandability of your code. Remember: code is at least as much about communicating to other developers as it is about feeding the computer instructions.</p><p>ES6 has several important features that help significantly improve these patterns, including: iterators, generators, modules, and classes.</p><h2 id="iterators" tabindex="-1"><a class="header-anchor" href="#iterators" aria-hidden="true">#</a> Iterators</h2><p>An <em>iterator</em> is a structured pattern for pulling information from a source in one-at-a-time fashion. This pattern has been around programming for a long time. And to be sure, JS developers have been ad hoc designing and implementing iterators in JS programs since before anyone can remember, so it&#39;s not at all a new topic.</p><p>What ES6 has done is introduce an implicit standardized interface for iterators. Many of the built-in data structures in JavaScript will now expose an iterator implementing this standard. And you can also construct your own iterators adhering to the same standard, for maximal interoperability.</p><p>Iterators are a way of organizing ordered, sequential, pull-based consumption of data.</p><p>For example, you may implement a utility that produces a new unique identifier each time it&#39;s requested. Or you may produce an infinite series of values that rotate through a fixed list, in round-robin fashion. Or you could attach an iterator to a database query result to pull out new rows one at a time.</p><p>Although they have not commonly been used in JS in such a manner, iterators can also be thought of as controlling behavior one step at a time. This can be illustrated quite clearly when considering generators (see &quot;Generators&quot; later in this chapter), though you can certainly do the same without generators.</p><h3 id="interfaces" tabindex="-1"><a class="header-anchor" href="#interfaces" aria-hidden="true">#</a> Interfaces</h3><p>At the time of this writing, ES6 section 25.1.1.2 (https://people.mozilla.org/~jorendorff/es6-draft.html#sec-iterator-interface) details the <code>Iterator</code> interface as having the following requirement:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Iterator [required]
	next() {method}: retrieves next IteratorResult
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>There are two optional members that some iterators are extended with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Iterator [optional]
	return() {method}: stops iterator and returns IteratorResult
	throw() {method}: signals error and returns IteratorResult
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The <code>IteratorResult</code> interface is specified as:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>IteratorResult
	value {property}: current iteration value or final return value
		(optional if `undefined`)
	done {property}: boolean, indicates completion status
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Note:</strong> I call these interfaces implicit not because they&#39;re not explicitly called out in the specification -- they are! -- but because they&#39;re not exposed as direct objects accessible to code. JavaScript does not, in ES6, support any notion of &quot;interfaces,&quot; so adherence for your own code is purely conventional. However, wherever JS expects an iterator -- a <code>for..of</code> loop, for instance -- what you provide must adhere to these interfaces or the code will fail.</p><p>There&#39;s also an <code>Iterable</code> interface, which describes objects that must be able to produce iterators:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Iterable
	@@iterator() {method}: produces an Iterator
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>If you recall from &quot;Built-In Symbols&quot; in Chapter 2, <code>@@iterator</code> is the special built-in symbol representing the method that can produce iterator(s) for the object.</p><h4 id="iteratorresult" tabindex="-1"><a class="header-anchor" href="#iteratorresult" aria-hidden="true">#</a> IteratorResult</h4><p>The <code>IteratorResult</code> interface specifies that the return value from any iterator operation will be an object of the form:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">/</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Built-in iterators will always return values of this form, but more properties are, of course, allowed to be present on the return value, as necessary.</p><p>For example, a custom iterator may add additional metadata to the result object (e.g., where the data came from, how long it took to retrieve, cache expiration length, frequency for the appropriate next request, etc.).</p><p><strong>Note:</strong> Technically, <code>value</code> is optional if it would otherwise be considered absent or unset, such as in the case of the value <code>undefined</code>. Because accessing <code>res.value</code> will produce <code>undefined</code> whether it&#39;s present with that value or absent entirely, the presence/absence of the property is more an implementation detail or an optimization (or both), rather than a functional issue.</p><h3 id="next-iteration" tabindex="-1"><a class="header-anchor" href="#next-iteration" aria-hidden="true">#</a> <code>next()</code> Iteration</h3><p>Let&#39;s look at an array, which is an iterable, and the iterator it can produce to consume its values:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 1, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 2, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 3, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Each time the method located at <code>Symbol.iterator</code> (see Chapters 2 and 7) is invoked on this <code>arr</code> value, it will produce a new fresh iterator. Most structures will do the same, including all the built-in data structures in JS.</p><p>However, a structure like an event queue consumer might only ever produce a single iterator (singleton pattern). Or a structure might only allow one unique iterator at a time, requiring the current one to be completed before a new one can be created.</p><p>The <code>it</code> iterator in the previous snippet doesn&#39;t report <code>done: true</code> when you receive the <code>3</code> value. You have to call <code>next()</code> again, in essence going beyond the end of the array&#39;s values, to get the complete signal <code>done: true</code>. It may not be clear why until later in this section, but that design decision will typically be considered a best practice.</p><p>Primitive string values are also iterables by default:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> greeting <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> greeting<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: &quot;h&quot;, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: &quot;e&quot;, done: false }</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Note:</strong> Technically, the primitive value itself isn&#39;t iterable, but thanks to &quot;boxing&quot;, <code>&quot;hello world&quot;</code> is coerced/converted to its <code>String</code> object wrapper form, which <em>is</em> an iterable. See the <em>Types &amp; Grammar</em> title of this series for more information.</p><p>ES6 also includes several new data structures, called collections (see Chapter 5). These collections are not only iterables themselves, but they also provide API method(s) to generate an iterator, such as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">cool</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> it1 <span class="token operator">=</span> m<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it2 <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: [ &quot;foo&quot;, 42 ], done: false }</span>
it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: [ &quot;foo&quot;, 42 ], done: false }</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The <code>next(..)</code> method of an iterator can optionally take one or more arguments. The built-in iterators mostly do not exercise this capability, though a generator&#39;s iterator definitely does (see &quot;Generators&quot; later in this chapter).</p><p>By general convention, including all the built-in iterators, calling <code>next(..)</code> on an iterator that&#39;s already been exhausted is not an error, but will simply continue to return the result <code>{ value: undefined, done: true }</code>.</p><h3 id="optional-return-and-throw" tabindex="-1"><a class="header-anchor" href="#optional-return-and-throw" aria-hidden="true">#</a> Optional: <code>return(..)</code> and <code>throw(..)</code></h3><p>The optional methods on the iterator interface -- <code>return(..)</code> and <code>throw(..)</code> -- are not implemented on most of the built-in iterators. However, they definitely do mean something in the context of generators, so see &quot;Generators&quot; for more specific information.</p><p><code>return(..)</code> is defined as sending a signal to an iterator that the consuming code is complete and will not be pulling any more values from it. This signal can be used to notify the producer (the iterator responding to <code>next(..)</code> calls) to perform any cleanup it may need to do, such as releasing/closing network, database, or file handle resources.</p><p>If an iterator has a <code>return(..)</code> present and any condition occurs that can automatically be interpreted as abnormal or early termination of consuming the iterator, <code>return(..)</code> will automatically be called. You can call <code>return(..)</code> manually as well.</p><p><code>return(..)</code> will return an <code>IteratorResult</code> object just like <code>next(..)</code> does. In general, the optional value you send to <code>return(..)</code> would be sent back as <code>value</code> in this <code>IteratorResult</code>, though there are nuanced cases where that might not be true.</p><p><code>throw(..)</code> is used to signal an exception/error to an iterator, which possibly may be used differently by the iterator than the completion signal implied by <code>return(..)</code>. It does not necessarily imply a complete stop of the iterator as <code>return(..)</code> generally does.</p><p>For example, with generator iterators, <code>throw(..)</code> actually injects a thrown exception into the generator&#39;s paused execution context, which can be caught with a <code>try..catch</code>. An uncaught <code>throw(..)</code> exception would end up abnormally aborting the generator&#39;s iterator.</p><p><strong>Note:</strong> By general convention, an iterator should not produce any more results after having called <code>return(..)</code> or <code>throw(..)</code>.</p><h3 id="iterator-loop" tabindex="-1"><a class="header-anchor" href="#iterator-loop" aria-hidden="true">#</a> Iterator Loop</h3><p>As we covered in the &quot;<code>for..of</code>&quot; section in Chapter 2, the ES6 <code>for..of</code> loop directly consumes a conforming iterable.</p><p>If an iterator is also an iterable, it can be used directly with the <code>for..of</code> loop. You make an iterator an iterable by giving it a <code>Symbol.iterator</code> method that simply returns the iterator itself:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">// make the `it` iterator an iterable</span>
	<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

it<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> it<span class="token punctuation">;</span>		<span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Now we can consume the <code>it</code> iterator with a <code>for..of</code> loop:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>To fully understand how such a loop works, recall the <code>for</code> equivalent of a <code>for..of</code> loop from Chapter 2:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v<span class="token punctuation">,</span> res<span class="token punctuation">;</span> <span class="token punctuation">(</span>res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>res<span class="token punctuation">.</span>done<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	v <span class="token operator">=</span> res<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If you look closely, you&#39;ll see that <code>it.next()</code> is called before each iteration, and then <code>res.done</code> is consulted. If <code>res.done</code> is <code>true</code>, the expression evaluates to <code>false</code> and the iteration doesn&#39;t occur.</p><p>Recall earlier that we suggested iterators should in general not return <code>done: true</code> along with the final intended value from the iterator. Now you can see why.</p><p>If an iterator returned <code>{ done: true, value: 42 }</code>, the <code>for..of</code> loop would completely discard the <code>42</code> value and it&#39;d be lost. For this reason, assuming that your iterator may be consumed by patterns like the <code>for..of</code> loop or its manual <code>for</code> equivalent, you should probably wait to return <code>done: true</code> for signaling completion until after you&#39;ve already returned all relevant iteration values.</p><p><strong>Warning:</strong> You can, of course, intentionally design your iterator to return some relevant <code>value</code> at the same time as returning <code>done: true</code>. But don&#39;t do this unless you&#39;ve documented that as the case, and thus implicitly forced consumers of your iterator to use a different pattern for iteration than is implied by <code>for..of</code> or its manual equivalent we depicted.</p><h3 id="custom-iterators" tabindex="-1"><a class="header-anchor" href="#custom-iterators" aria-hidden="true">#</a> Custom Iterators</h3><p>In addition to the standard built-in iterators, you can make your own! All it takes to make them interoperate with ES6&#39;s consumption facilities (e.g., the <code>for..of</code> loop and the <code>...</code> operator) is to adhere to the proper interface(s).</p><p>Let&#39;s try constructing an iterator that produces the infinite series of numbers in the Fibonacci sequence:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> Fib <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> n1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> n2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token comment">// make the iterator an iterable</span>
			<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

			<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">var</span> current <span class="token operator">=</span> n2<span class="token punctuation">;</span>
				n2 <span class="token operator">=</span> n1<span class="token punctuation">;</span>
				n1 <span class="token operator">=</span> n1 <span class="token operator">+</span> current<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> current<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>

			<span class="token keyword">return</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
					<span class="token string">&quot;Fibonacci sequence abandoned.&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> v<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> Fib<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 1 2 3 5 8 13 21 34 55</span>
<span class="token comment">// Fibonacci sequence abandoned.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>Warning:</strong> If we hadn&#39;t inserted the <code>break</code> condition, this <code>for..of</code> loop would have run forever, which is probably not the desired result in terms of breaking your program!</p><p>The <code>Fib[Symbol.iterator]()</code> method when called returns the iterator object with <code>next()</code> and <code>return(..)</code> methods on it. State is maintained via <code>n1</code> and <code>n2</code> variables, which are kept by the closure.</p><p>Let&#39;s <em>next</em> consider an iterator that is designed to run through a series (aka a queue) of actions, one item at a time:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> tasks <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> steps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token comment">// make the iterator an iterable</span>
			<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

			<span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>steps<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">let</span> res <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token operator">...</span>args <span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> res<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>

			<span class="token keyword">return</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				steps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> v<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>The iterator on <code>tasks</code> steps through functions found in the <code>actions</code> array property, if any, and executes them one at a time, passing in whatever arguments you pass to <code>next(..)</code>, and returning any return value to you in the standard <code>IteratorResult</code> object.</p><p>Here&#39;s how we could use this <code>tasks</code> queue:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>tasks<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
	<span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;step 1:&quot;</span><span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;step 2:&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;step 3:&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> z<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> tasks<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// step 1: 10</span>
						<span class="token comment">// { value:   20, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// step 2: 20 50</span>
						<span class="token comment">// { value:  120, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">120</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// step 3: 20 50 120</span>
						<span class="token comment">// { value: 1120, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>This particular usage reinforces that iterators can be a pattern for organizing functionality, not just data. It&#39;s also reminiscent of what we&#39;ll see with generators in the next section.</p><p>You could even get creative and define an iterator that represents meta operations on a single piece of data. For example, we could define an iterator for numbers that by default ranges from <code>0</code> up to (or down to, for negative numbers) the number in question.</p><p>Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
		<span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>
		Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			<span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> i<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> top <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">;</span>

				<span class="token comment">// iterate positively or negatively?</span>
				inc <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span>top <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token keyword">return</span> <span class="token punctuation">{</span>
					<span class="token comment">// make the iterator itself an iterable!</span>
					<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

					<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// initial iteration always 0</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							<span class="token comment">// iterating positively</span>
							<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>top <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span>i <span class="token operator">+</span> inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							<span class="token comment">// iterating negatively</span>
							<span class="token keyword">else</span> <span class="token punctuation">{</span>
								i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span>i <span class="token operator">+</span> inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>

							<span class="token comment">// done after this iteration?</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> top<span class="token punctuation">)</span> done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

							<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> i<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>Now, what tricks does this creativity afford us?</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">of</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> i <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 0 1 2 3</span>

<span class="token punctuation">[</span><span class="token operator">...</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">// [0,-1,-2,-3]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Those are some fun tricks, though the practical utility is somewhat debatable. But then again, one might wonder why ES6 didn&#39;t just ship with such a minor but delightful feature easter egg!?</p><p>I&#39;d be remiss if I didn&#39;t at least remind you that extending native prototypes as I&#39;m doing in the previous snippet is something you should only do with caution and awareness of potential hazards.</p><p>In this case, the chances that you&#39;ll have a collision with other code or even a future JS feature is probably exceedingly low. But just beware of the slight possibility. And document what you&#39;re doing verbosely for posterity&#39;s sake.</p><p><strong>Note:</strong> I&#39;ve expounded on this particular technique in this blog post (http://blog.getify.com/iterating-es6-numbers/) if you want more details. And this comment (http://blog.getify.com/iterating-es6-numbers/comment-page-1/#comment-535294) even suggests a similar trick but for making string character ranges.</p><h3 id="iterator-consumption" tabindex="-1"><a class="header-anchor" href="#iterator-consumption" aria-hidden="true">#</a> Iterator Consumption</h3><p>We&#39;ve already shown consuming an iterator item by item with the <code>for..of</code> loop. But there are other ES6 structures that can consume iterators.</p><p>Let&#39;s consider the iterator attached to this array (though any iterator we choose would have the following behaviors):</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>The <code>...</code> spread operator fully exhausts an iterator. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>w<span class="token punctuation">,</span>p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z <span class="token operator">+</span> w <span class="token operator">+</span> p <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token operator">...</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 15</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>...</code> can also spread an iterator inside an array:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span>a<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
b<span class="token punctuation">;</span>						<span class="token comment">// [0,1,2,3,4,5,6]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Array destructuring (see &quot;Destructuring&quot; in Chapter 2) can partially or completely (if paired with a <code>...</code> rest/gather operator) consume an iterator:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> it <span class="token operator">=</span> a<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> it<span class="token punctuation">;</span>			<span class="token comment">// take just the first two elements from `it`</span>
<span class="token keyword">var</span> <span class="token punctuation">[</span>z<span class="token punctuation">,</span> <span class="token operator">...</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> it<span class="token punctuation">;</span>		<span class="token comment">// take the third, then the rest all at once</span>

<span class="token comment">// is `it` fully exhausted? Yep.</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>

x<span class="token punctuation">;</span>						<span class="token comment">// 1</span>
y<span class="token punctuation">;</span>						<span class="token comment">// 2</span>
z<span class="token punctuation">;</span>						<span class="token comment">// 3</span>
w<span class="token punctuation">;</span>						<span class="token comment">// [4,5]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="generators" tabindex="-1"><a class="header-anchor" href="#generators" aria-hidden="true">#</a> Generators</h2><p>All functions run to completion, right? In other words, once a function starts running, it finishes before anything else can interrupt.</p><p>At least that&#39;s how it&#39;s been for the whole history of JavaScript up to this point. As of ES6, a new somewhat exotic form of function is being introduced, called a generator. A generator can pause itself in mid-execution, and can be resumed either right away or at a later time. So it clearly does not hold the run-to-completion guarantee that normal functions do.</p><p>Moreover, each pause/resume cycle in mid-execution is an opportunity for two-way message passing, where the generator can return a value, and the controlling code that resumes it can send a value back in.</p><p>As with iterators in the previous section, there are multiple ways to think about what a generator is, or rather what it&#39;s most useful for. There&#39;s no one right answer, but we&#39;ll try to consider several angles.</p><p><strong>Note:</strong> See the <em>Async &amp; Performance</em> title of this series for more information about generators, and also see Chapter 4 of this current title.</p><h3 id="syntax" tabindex="-1"><a class="header-anchor" href="#syntax" aria-hidden="true">#</a> Syntax</h3><p>The generator function is declared with this new syntax:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The position of the <code>*</code> is not functionally relevant. The same declaration could be written as any of the following:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span><span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The <em>only</em> difference here is stylistic preference. Most other literature seems to prefer <code>function* foo(..) { .. }</code>. I prefer <code>function *foo(..) { .. }</code>, so that&#39;s how I&#39;ll present them for the rest of this title.</p><p>My reason is purely didactic in nature. In this text, when referring to a generator function, I will use <code>*foo(..)</code>, as opposed to <code>foo(..)</code> for a normal function. I observe that <code>*foo(..)</code> more closely matches the <code>*</code> positioning of <code>function *foo(..) { .. }</code>.</p><p>Moreover, as we saw in Chapter 2 with concise methods, there&#39;s a concise generator form in object literals:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>I would say that with concise generators, <code>*foo() { .. }</code> is rather more natural than <code>* foo() { .. }</code>. So that further argues for matching the consistency with <code>*foo()</code>.</p><p>Consistency eases understanding and learning.</p><h4 id="executing-a-generator" tabindex="-1"><a class="header-anchor" href="#executing-a-generator" aria-hidden="true">#</a> Executing a Generator</h4><p>Though a generator is declared with <code>*</code>, you still execute it like a normal function:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>You can still pass it arguments, as in:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The major difference is that executing a generator, like <code>foo(5,10)</code> doesn&#39;t actually run the code in the generator. Instead, it produces an iterator that will control the generator to execute its code.</p><p>We&#39;ll come back to this later in &quot;Iterator Control,&quot; but briefly:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// to start/advanced `*foo()`, call</span>
<span class="token comment">// `it.next(..)`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="yield" tabindex="-1"><a class="header-anchor" href="#yield" aria-hidden="true">#</a> <code>yield</code></h4><p>Generators also have a new keyword you can use inside them, to signal the pause point: <code>yield</code>. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

	<span class="token keyword">yield</span><span class="token punctuation">;</span>

	<span class="token keyword">var</span> z <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>In this <code>*foo()</code> generator, the operations on the first two lines would run at the beginning, then <code>yield</code> would pause the generator. If and when resumed, the last line of <code>*foo()</code> would run. <code>yield</code> can appear any number of times (or not at all, technically!) in a generator.</p><p>You can even put <code>yield</code> inside a loop, and it can represent a repeated pause point. In fact, a loop that never completes just means a generator that never completes, which is completely valid, and sometimes entirely what you need.</p><p><code>yield</code> is not just a pause point. It&#39;s an expression that sends out a value when pausing the generator. Here&#39;s a <code>while..true</code> loop in a generator that for each iteration <code>yield</code>s a new random number:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The <code>yield ..</code> expression not only sends a value -- <code>yield</code> without a value is the same as <code>yield undefined</code> -- but also receives (e.g., is replaced by) the eventual resumption value. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">10</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This generator will first <code>yield</code> out the value <code>10</code> when pausing itself. When you resume the generator -- using the <code>it.next(..)</code> we referred to earlier -- whatever value (if any) you resume with will replace/complete the whole <code>yield 10</code> expression, meaning that value will be assigned to the <code>x</code> variable.</p><p>A <code>yield ..</code> expression can appear anywhere a normal expression can. For example:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> arr<span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>*foo()</code> here has four <code>yield ..</code> expressions. Each <code>yield</code> results in the generator pausing to wait for a resumption value that&#39;s then used in the various expression contexts.</p><p><code>yield</code> is not technically an operator, though when used like <code>yield 1</code> it sure looks like it. Because <code>yield</code> can be used all by itself as in <code>var x = yield;</code>, thinking of it as an operator can sometimes be confusing.</p><p>Technically, <code>yield ..</code> is of the same &quot;expression precedence&quot; -- similar conceptually to operator precedence -- as an assignment expression like <code>a = 3</code>. That means <code>yield ..</code> can basically appear anywhere <code>a = 3</code> can validly appear.</p><p>Let&#39;s illustrate the symmetry:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>

a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>					<span class="token comment">// valid</span>
b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>			<span class="token comment">// invalid</span>
b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// valid</span>

<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>				<span class="token comment">// valid</span>
a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>		<span class="token comment">// invalid</span>
a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// valid</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Note:</strong> If you think about it, it makes a sort of conceptual sense that a <code>yield ..</code> expression would behave similar to an assignment expression. When a paused <code>yield</code> expression is resumed, it&#39;s completed/replaced by the resumption value in a way that&#39;s not terribly dissimilar from being &quot;assigned&quot; that value.</p><p>The takeaway: if you need <code>yield ..</code> to appear in a position where an assignment like <code>a = 3</code> would not itself be allowed, it needs to be wrapped in a <code>( )</code>.</p><p>Because of the low precedence of the <code>yield</code> keyword, almost any expression after a <code>yield ..</code> will be computed first before being sent with <code>yield</code>. Only the <code>...</code> spread operator and the <code>,</code> comma operator have lower precedence, meaning they&#39;d bind after the <code>yield</code> has been evaluated.</p><p>So just like with multiple operators in normal statements, another case where <code>( )</code> might be needed is to override (elevate) the low precedence of <code>yield</code>, such as the difference between these expressions:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">yield</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>			<span class="token comment">// same as `yield (2 + 3)`</span>

<span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>			<span class="token comment">// `yield 2` first, then `+ 3`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Just like <code>=</code> assignment, <code>yield</code> is also &quot;right-associative,&quot; which means that multiple <code>yield</code> expressions in succession are treated as having been <code>( .. )</code> grouped from right to left. So, <code>yield yield yield 3</code> is treated as <code>yield (yield (yield 3))</code>. A &quot;left-associative&quot; interpretation like <code>((yield) yield) yield 3</code> would make no sense.</p><p>Just like with operators, it&#39;s a good idea to use <code>( .. )</code> grouping, even if not strictly required, to disambiguate your intent if <code>yield</code> is combined with other operators or <code>yield</code>s.</p><p><strong>Note:</strong> See the <em>Types &amp; Grammar</em> title of this series for more information about operator precedence and associativity.</p><h4 id="yield-1" tabindex="-1"><a class="header-anchor" href="#yield-1" aria-hidden="true">#</a> <code>yield *</code></h4><p>In the same way that the <code>*</code> makes a <code>function</code> declaration into <code>function *</code> generator declaration, a <code>*</code> makes <code>yield</code> into <code>yield *</code>, which is a very different mechanism, called <em>yield delegation</em>. Grammatically, <code>yield *..</code> will behave the same as a <code>yield ..</code>, as discussed in the previous section.</p><p><code>yield * ..</code> requires an iterable; it then invokes that iterable&#39;s iterator, and delegates its own host generator&#39;s control to that iterator until it&#39;s exhausted. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Note:</strong> As with the <code>*</code> position in a generator&#39;s declaration (discussed earlier), the <code>*</code> positioning in <code>yield *</code> expressions is stylistically up to you. Most other literature prefers <code>yield* ..</code>, but I prefer <code>yield *..</code>, for very symmetrical reasons as already discussed.</p><p>The <code>[1,2,3]</code> value produces an iterator that will step through its values, so the <code>*foo()</code> generator will yield those values out as it&#39;s consumed. Another way to illustrate the behavior is in yield delegating to another generator:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The iterator produced when <code>*bar()</code> calls <code>*foo()</code> is delegated to via <code>yield *</code>, meaning whatever value(s) <code>*foo()</code> produces will be produced by <code>*bar()</code>.</p><p>Whereas with <code>yield ..</code> the completion value of the expression comes from resuming the generator with <code>it.next(..)</code>, the completion value of the <code>yield *..</code> expression comes from the return value (if any) from the delegated-to iterator.</p><p>Built-in iterators generally don&#39;t have return values, as we covered at the end of the &quot;Iterator Loop&quot; section earlier in this chapter. But if you define your own custom iterator (or generator), you can design it to <code>return</code> a value, which <code>yield *..</code> would capture:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;x:&quot;</span><span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 3</span>
<span class="token comment">// x: 4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>While the <code>1</code>, <code>2</code>, and <code>3</code> values are <code>yield</code>ed out of <code>*foo()</code> and then out of <code>*bar()</code>, the <code>4</code> value returned from <code>*foo()</code> is the completion value of the <code>yield *foo()</code> expression, which then gets assigned to <code>x</code>.</p><p>Because <code>yield *</code> can call another generator (by way of delegating to its iterator), it can also perform a sort of generator recursion by calling itself:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The result from <code>foo(1)</code> and then calling the iterator&#39;s <code>next()</code> to run it through its recursive steps will be <code>24</code>. The first <code>*foo(..)</code> run has <code>x</code> at value <code>1</code>, which is <code>x &lt; 3</code>. <code>x + 1</code> is passed recursively to <code>*foo(..)</code>, so <code>x</code> is then <code>2</code>. One more recursive call results in <code>x</code> of <code>3</code>.</p><p>Now, because <code>x &lt; 3</code> fails, the recursion stops, and <code>return 3 * 2</code> gives <code>6</code> back to the previous call&#39;s <code>yield *..</code> expression, which is then assigned to <code>x</code>. Another <code>return 6 * 2</code> returns <code>12</code> back to the previous call&#39;s <code>x</code>. Finally <code>12 * 2</code>, or <code>24</code>, is returned from the completed run of the <code>*foo(..)</code> generator.</p><h3 id="iterator-control" tabindex="-1"><a class="header-anchor" href="#iterator-control" aria-hidden="true">#</a> Iterator Control</h3><p>Earlier, we briefly introduced the concept that generators are controlled by iterators. Let&#39;s fully dig into that now.</p><p>Recall the recursive <code>*foo(..)</code> from the previous section. Here&#39;s how we&#39;d run it:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 24, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>In this case, the generator doesn&#39;t really ever pause, as there&#39;s no <code>yield ..</code> expression. Instead, <code>yield *</code> just keeps the current iteration step going via the recursive call. So, just one call to the iterator&#39;s <code>next()</code> function fully runs the generator.</p><p>Now let&#39;s consider a generator that will have multiple steps and thus multiple produced values:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>We already know we can consume an iterator, even one attached to a generator like <code>*foo()</code>, with a <code>for..of</code> loop:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Note:</strong> The <code>for..of</code> loop requires an iterable. A generator function reference (like <code>foo</code>) by itself is not an iterable; you must execute it with <code>foo()</code> to get the iterator (which is also an iterable, as we explained earlier in this chapter). You could theoretically extend the <code>GeneratorPrototype</code> (the prototype of all generator functions) with a <code>Symbol.iterator</code> function that essentially just does <code>return this()</code>. That would make the <code>foo</code> reference itself an iterable, which means <code>for (var v of foo) { .. }</code> (notice no <code>()</code> on <code>foo</code>) will work.</p><p>Let&#39;s instead iterate the generator manually:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 2, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 3, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>If you look closely, there are three <code>yield</code> statements and four <code>next()</code> calls. That may seem like a strange mismatch. In fact, there will always be one more <code>next()</code> call than <code>yield</code> expression, assuming all are evaluated and the generator is fully run to completion.</p><p>But if you look at it from the opposite perspective (inside-out instead of outside-in), the matching between <code>yield</code> and <code>next()</code> makes more sense.</p><p>Recall that the <code>yield ..</code> expression will be completed by the value you resume the generator with. That means the argument you pass to <code>next(..)</code> completes whatever <code>yield ..</code> expression is currently paused waiting for a completion.</p><p>Let&#39;s illustrate this perspective this way:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>In this snippet, each <code>yield ..</code> is sending a value out (<code>1</code>, <code>2</code>, <code>3</code>), but more directly, it&#39;s pausing the generator to wait for a value. In other words, it&#39;s almost like asking the question, &quot;What value should I use here? I&#39;ll wait to hear back.&quot;</p><p>Now, here&#39;s how we control <code>*foo()</code> to start it up:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>That first <code>next()</code> call is starting up the generator from its initial paused state, and running it to the first <code>yield</code>. At the moment you call that first <code>next()</code>, there&#39;s no <code>yield ..</code> expression waiting for a completion. If you passed a value to that first <code>next()</code> call, it would currently just be thrown away, because no <code>yield</code> is waiting to receive such a value.</p><p><strong>Note:</strong> An early proposal for the &quot;beyond ES6&quot; timeframe <em>would</em> let you access a value passed to an initial <code>next(..)</code> call via a separate meta property (see Chapter 7) inside the generator.</p><p>Now, let&#39;s answer the currently pending question, &quot;What value should I assign to <code>x</code>?&quot; We&#39;ll answer it by sending a value to the <em>next</em> <code>next(..)</code> call:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 2, done: false }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Now, the <code>x</code> will have the value <code>&quot;foo&quot;</code>, but we&#39;ve also asked a new question, &quot;What value should I assign to <code>y</code>?&quot; And we answer:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 3, done: false }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Answer given, another question asked. Final answer:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;baz&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// &quot;foo&quot; &quot;bar&quot; &quot;baz&quot;</span>
						<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Now it should be clearer how each <code>yield ..</code> &quot;question&quot; is answered by the <em>next</em> <code>next(..)</code> call, and so the &quot;extra&quot; <code>next()</code> call we observed is always just the initial one that starts everything going.</p><p>Let&#39;s put all those steps together:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// start up the generator</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>

<span class="token comment">// answer first question</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 2, done: false }</span>

<span class="token comment">// answer second question</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 3, done: false }</span>

<span class="token comment">// answer third question</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token string">&quot;baz&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// &quot;foo&quot; &quot;bar&quot; &quot;baz&quot;</span>
						<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>You can think of a generator as a producer of values, in which case each iteration is simply producing a value to be consumed.</p><p>But in a more general sense, perhaps it&#39;s appropriate to think of generators as controlled, progressive code execution, much like the <code>tasks</code> queue example from the earlier &quot;Custom Iterators&quot; section.</p><p><strong>Note:</strong> That perspective is exactly the motivation for how we&#39;ll revisit generators in Chapter 4. Specifically, there&#39;s no reason that <code>next(..)</code> has to be called right away after the previous <code>next(..)</code> finishes. While the generator&#39;s inner execution context is paused, the rest of the program continues unblocked, including the ability for asynchronous actions to control when the generator is resumed.</p><h3 id="early-completion" tabindex="-1"><a class="header-anchor" href="#early-completion" aria-hidden="true">#</a> Early Completion</h3><p>As we covered earlier in this chapter, the iterator attached to a generator supports the optional <code>return(..)</code> and <code>throw(..)</code> methods. Both of them have the effect of aborting a paused generator immediately.</p><p>Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// { value: 42, done: true }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>return(x)</code> is kind of like forcing a <code>return x</code> to be processed at exactly that moment, such that you get the specified value right back. Once a generator is completed, either normally or early as shown, it no longer processes any code or returns any values.</p><p>In addition to <code>return(..)</code> being callable manually, it&#39;s also called automatically at the end of iteration by any of the ES6 constructs that consume iterators, such as the <code>for..of</code> loop and the <code>...</code> spread operator.</p><p>The purpose for this capability is so the generator can be notified if the controlling code is no longer going to iterate over it anymore, so that it can perhaps do any cleanup tasks (freeing up resources, resetting status, etc.). Identical to a normal function cleanup pattern, the main way to accomplish this is to use a <code>finally</code> clause:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;cleanup!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 3</span>
<span class="token comment">// cleanup!</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// cleanup!</span>
						<span class="token comment">// { value: 42, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>Warning:</strong> Do not put a <code>yield</code> statement inside the <code>finally</code> clause! It&#39;s valid and legal, but it&#39;s a really terrible idea. It acts in a sense as deferring the completion of the <code>return(..)</code> call you made, as any <code>yield ..</code> expressions in the <code>finally</code> clause are respected to pause and send messages; you don&#39;t immediately get a completed generator as expected. There&#39;s basically no good reason to opt in to that crazy <em>bad part</em>, so avoid doing so!</p><p>In addition to the previous snippet showing how <code>return(..)</code> aborts the generator while still triggering the <code>finally</code> clause, it also demonstrates that a generator produces a whole new iterator each time it&#39;s called. In fact, you can use multiple iterators attached to the same generator concurrently:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it1 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>
it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 2, done: false }</span>

<span class="token keyword">var</span> it2 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>

it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 3, done: false }</span>

it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 2, done: false }</span>
it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 3, done: false }</span>

it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="early-abort" tabindex="-1"><a class="header-anchor" href="#early-abort" aria-hidden="true">#</a> Early Abort</h4><p>Instead of calling <code>return(..)</code>, you can call <code>throw(..)</code>. Just like <code>return(x)</code> is essentially injecting a <code>return x</code> into the generator at its current pause point, calling <code>throw(x)</code> is essentially like injecting a <code>throw x</code> at the pause point.</p><p>Other than the exception behavior (we cover what that means to <code>try</code> clauses in the next section), <code>throw(..)</code> produces the same sort of early completion that aborts the generator&#39;s run at its current pause point. For example:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
	it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> <span class="token string">&quot;Oops!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Exception: Oops!</span>
<span class="token punctuation">}</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Because <code>throw(..)</code> basically injects a <code>throw ..</code> in replacement of the <code>yield 1</code> line of the generator, and nothing handles this exception, it immediately propagates back out to the calling code, which handles it with a <code>try..catch</code>.</p><p>Unlike <code>return(..)</code>, the iterator&#39;s <code>throw(..)</code> method is never called automatically.</p><p>Of course, though not shown in the previous snippet, if a <code>try..finally</code> clause was waiting inside the generator when you call <code>throw(..)</code>, the <code>finally</code> clause would be given a chance to complete before the exception is propagated back to the calling code.</p><h3 id="error-handling" tabindex="-1"><a class="header-anchor" href="#error-handling" aria-hidden="true">#</a> Error Handling</h3><p>As we&#39;ve already hinted, error handling with generators can be expressed with <code>try..catch</code>, which works in both inbound and outbound directions:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>

	<span class="token keyword">throw</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 1, done: false }</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
	it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> <span class="token string">&quot;Hi!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Hi!</span>
						<span class="token comment">// { value: 2, done: false }</span>
	it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;never gets here&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Hello!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Errors can also propagate in both directions through <code>yield *</code> delegation:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>

	<span class="token keyword">throw</span> <span class="token string">&quot;foo: e2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;never gets here&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
	it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// { value: 1, done: false }</span>

	it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> <span class="token string">&quot;e1&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// e1</span>
						<span class="token comment">// { value: 2, done: false }</span>

	it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// foo: e2</span>
						<span class="token comment">// { value: undefined, done: true }</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;never gets here&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>When <code>*foo()</code> calls <code>yield 1</code>, the <code>1</code> value passes through <code>*bar()</code> untouched, as we&#39;ve already seen.</p><p>But what&#39;s most interesting about this snippet is that when <code>*foo()</code> calls <code>throw &quot;foo: e2&quot;</code>, this error propagates to <code>*bar()</code> and is immediately caught by <code>*bar()</code>&#39;s <code>try..catch</code> block. The error doesn&#39;t pass through <code>*bar()</code> like the <code>1</code> value did.</p><p><code>*bar()</code>&#39;s <code>catch</code> then does a normal output of <code>err</code> (<code>&quot;foo: e2&quot;</code>) and then <code>*bar()</code> finishes normally, which is why the <code>{ value: undefined, done: true }</code> iterator result comes back from <code>it.next()</code>.</p><p>If <code>*bar()</code> didn&#39;t have a <code>try..catch</code> around the <code>yield *..</code> expression, the error would of course propagate all the way out, and on the way through it still would complete (abort) <code>*bar()</code>.</p><h3 id="transpiling-a-generator" tabindex="-1"><a class="header-anchor" href="#transpiling-a-generator" aria-hidden="true">#</a> Transpiling a Generator</h3><p>Is it possible to represent a generator&#39;s capabilities prior to ES6? It turns out it is, and there are several great tools that do so, including most notably Facebook&#39;s Regenerator tool (https://facebook.github.io/regenerator/).</p><p>But just to better understand generators, let&#39;s try our hand at manually converting. Basically, we&#39;re going to create a simple closure-based state machine.</p><p>We&#39;ll keep our source generator really simple:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">42</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>To start, we&#39;ll need a function called <code>foo()</code> that we can execute, which needs to return an iterator:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>

	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// ..</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// we&#39;ll skip `return(..)` and `throw(..)`</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Now, we need some inner variable to keep track of where we are in the steps of our &quot;generator&quot;&#39;s logic. We&#39;ll call it <code>state</code>. There will be three states: <code>0</code> initially, <code>1</code> while waiting to fulfill the <code>yield</code> expression, and <code>2</code> once the generator is complete.</p><p>Each time <code>next(..)</code> is called, we need to process the next step, and then increment <code>state</code>. For convenience, we&#39;ll put each step into a <code>case</code> clause of a <code>switch</code> statement, and we&#39;ll hold that in an inner function called <code>nextState(..)</code> that <code>next(..)</code> can call. Also, because <code>x</code> is a variable across the overall scope of the &quot;generator,&quot; it needs to live outside the <code>nextState(..)</code> function.</p><p>Here it is all together (obviously somewhat simplified, to keep the conceptual illustration clearer):</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">nextState</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
				state<span class="token operator">++</span><span class="token punctuation">;</span>

				<span class="token comment">// the `yield` expression</span>
				<span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
				state<span class="token operator">++</span><span class="token punctuation">;</span>

				<span class="token comment">// `yield` expression fulfilled</span>
				x <span class="token operator">=</span> v<span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// the implicit `return`</span>
				<span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

			<span class="token comment">// no need to handle state `2`</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">nextState</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> ret<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// we&#39;ll skip `return(..)` and `throw(..)`</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>And finally, let&#39;s test our pre-ES6 &quot;generator&quot;:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// { value: 42, done: false }</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 10</span>
						<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Not bad, huh? Hopefully this exercise solidifies in your mind that generators are actually just simple syntax for state machine logic. That makes them widely applicable.</p><h3 id="generator-uses" tabindex="-1"><a class="header-anchor" href="#generator-uses" aria-hidden="true">#</a> Generator Uses</h3><p>So, now that we much more deeply understand how generators work, what are they useful for?</p><p>We&#39;ve seen two major patterns:</p><ul><li><p><em>Producing a series of values:</em> This usage can be simple (e.g., random strings or incremented numbers), or it can represent more structured data access (e.g., iterating over rows returned from a database query).</p><p>Either way, we use the iterator to control a generator so that some logic can be invoked for each call to <code>next(..)</code>. Normal iterators on data structures merely pull values without any controlling logic.</p></li><li><p><em>Queue of tasks to perform serially:</em> This usage often represents flow control for the steps in an algorithm, where each step requires retrieval of data from some external source. The fulfillment of each piece of data may be immediate, or may be asynchronously delayed.</p><p>From the perspective of the code inside the generator, the details of sync or async at a <code>yield</code> point are entirely opaque. Moreover, these details are intentionally abstracted away, such as not to obscure the natural sequential expression of steps with such implementation complications. Abstraction also means the implementations can be swapped/refactored often without touching the code in the generator at all.</p></li></ul><p>When generators are viewed in light of these uses, they become a lot more than just a different or nicer syntax for a manual state machine. They are a powerful abstraction tool for organizing and controlling orderly production and consumption of data.</p><h2 id="modules" tabindex="-1"><a class="header-anchor" href="#modules" aria-hidden="true">#</a> Modules</h2><p>I don&#39;t think it&#39;s an exaggeration to suggest that the single most important code organization pattern in all of JavaScript is, and always has been, the module. For myself, and I think for a large cross-section of the community, the module pattern drives the vast majority of code.</p><h3 id="the-old-way" tabindex="-1"><a class="header-anchor" href="#the-old-way" aria-hidden="true">#</a> The Old Way</h3><p>The traditional module pattern is based on an outer function with inner variables and functions, and a returned &quot;public API&quot; with methods that have closure over the inner data and capabilities. It&#39;s often expressed like this:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// public API</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">greeting</span><span class="token operator">:</span> greeting
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token function">Hello</span><span class="token punctuation">(</span> <span class="token string">&quot;Kyle&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
me<span class="token punctuation">.</span><span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// Hello Kyle!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>This <code>Hello(..)</code> module can produce multiple instances by being called subsequent times. Sometimes, a module is only called for as a singleton (i.e., it just needs one instance), in which case a slight variation on the previous snippet, using an IIFE, is common:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// public API</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">greeting</span><span class="token operator">:</span> greeting
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token string">&quot;Kyle&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

me<span class="token punctuation">.</span><span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// Hello Kyle!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This pattern is tried and tested. It&#39;s also flexible enough to have a wide assortment of variations for a number of different scenarios.</p><p>One of the most common is the Asynchronous Module Definition (AMD), and another is the Universal Module Definition (UMD). We won&#39;t cover the particulars of these patterns and techniques here, but they&#39;re explained extensively in many places online.</p><h3 id="moving-forward" tabindex="-1"><a class="header-anchor" href="#moving-forward" aria-hidden="true">#</a> Moving Forward</h3><p>As of ES6, we no longer need to rely on the enclosing function and closure to provide us with module support. ES6 modules have first class syntactic and functional support.</p><p>Before we get into the specific syntax, it&#39;s important to understand some fairly significant conceptual differences with ES6 modules compared to how you may have dealt with modules in the past:</p><ul><li><p>ES6 uses file-based modules, meaning one module per file. At this time, there is no standardized way of combining multiple modules into a single file.</p><p>That means that if you are going to load ES6 modules directly into a browser web application, you will be loading them individually, not as a large bundle in a single file as has been common in performance optimization efforts.</p><p>It&#39;s expected that the contemporaneous advent of HTTP/2 will significantly mitigate any such performance concerns, as it operates on a persistent socket connection and thus can very efficiently load many smaller files in parallel and interleaved with one another.</p></li><li><p>The API of an ES6 module is static. That is, you define statically what all the top-level exports are on your module&#39;s public API, and those cannot be amended later.</p><p>Some uses are accustomed to being able to provide dynamic API definitions, where methods can be added/removed/replaced in response to runtime conditions. Either these uses will have to change to fit with ES6 static APIs, or they will have to restrain the dynamic changes to properties/methods of a second-level object.</p></li><li><p>ES6 modules are singletons. That is, there&#39;s only one instance of the module, which maintains its state. Every time you import that module into another module, you get a reference to the one centralized instance. If you want to be able to produce multiple module instances, your module will need to provide some sort of factory to do it.</p></li><li><p>The properties and methods you expose on a module&#39;s public API are not just normal assignments of values or references. They are actual bindings (almost like pointers) to the identifiers in your inner module definition.</p><p>In pre-ES6 modules, if you put a property on your public API that holds a primitive value like a number or string, that property assignment was by value-copy, and any internal update of a corresponding variable would be separate and not affect the public copy on the API object.</p><p>With ES6, exporting a local private variable, even if it currently holds a primitive string/number/etc, exports a binding to the variable. If the module changes the variable&#39;s value, the external import binding now resolves to that new value.</p></li><li><p>Importing a module is the same thing as statically requesting it to load (if it hasn&#39;t already). If you&#39;re in a browser, that implies a blocking load over the network. If you&#39;re on a server (i.e., Node.js), it&#39;s a blocking load from the filesystem.</p><p>However, don&#39;t panic about the performance implications. Because ES6 modules have static definitions, the import requirements can be statically scanned, and loads will happen preemptively, even before you&#39;ve used the module.</p><p>ES6 doesn&#39;t actually specify or handle the mechanics of how these load requests work. There&#39;s a separate notion of a Module Loader, where each hosting environment (browser, Node.js, etc.) provides a default Loader appropriate to the environment. The importing of a module uses a string value to represent where to get the module (URL, file path, etc.), but this value is opaque in your program and only meaningful to the Loader itself.</p><p>You can define your own custom Loader if you want more fine-grained control than the default Loader affords -- which is basically none, as it&#39;s totally hidden from your program&#39;s code.</p></li></ul><p>As you can see, ES6 modules will serve the overall use case of organizing code with encapsulation, controlling public APIs, and referencing dependency imports. But they have a very particular way of doing so, and that may or may not fit very closely with how you&#39;ve already been doing modules for years.</p><h4 id="commonjs" tabindex="-1"><a class="header-anchor" href="#commonjs" aria-hidden="true">#</a> CommonJS</h4><p>There&#39;s a similar, but not fully compatible, module syntax called CommonJS, which is familiar to those in the Node.js ecosystem.</p><p>For lack of a more tactful way to say this, in the long run, ES6 modules essentially are bound to supersede all previous formats and standards for modules, even CommonJS, as they are built on syntactic support in the language. This will, in time, inevitably win out as the superior approach, if for no other reason than ubiquity.</p><p>We face a fairly long road to get to that point, though. There are literally hundreds of thousands of CommonJS style modules in the server-side JavaScript world, and 10 times that many modules of varying format standards (UMD, AMD, ad hoc) in the browser world. It will take many years for the transitions to make any significant progress.</p><p>In the interim, module transpilers/converters will be an absolute necessity. You might as well just get used to that new reality. Whether you author in regular modules, AMD, UMD, CommonJS, or ES6, these tools will have to parse and convert to a format that is suitable for whatever environment your code will run in.</p><p>For Node.js, that probably means (for now) that the target is CommonJS. For the browser, it&#39;s probably UMD or AMD. Expect lots of flux on this over the next few years as these tools mature and best practices emerge.</p><p>From here on out, my best advice on modules is this: whatever format you&#39;ve been religiously attached to with strong affinity, also develop an appreciation for and understanding of ES6 modules, such as they are, and let your other module tendencies fade. They <em>are</em> the future of modules in JS, even if that reality is a bit of a ways off.</p><h3 id="the-new-way" tabindex="-1"><a class="header-anchor" href="#the-new-way" aria-hidden="true">#</a> The New Way</h3><p>The two main new keywords that enable ES6 modules are <code>import</code> and <code>export</code>. There&#39;s lots of nuance to the syntax, so let&#39;s take a deeper look.</p><p><strong>Warning:</strong> An important detail that&#39;s easy to overlook: both <code>import</code> and <code>export</code> must always appear in the top-level scope of their respective usage. For example, you cannot put either an <code>import</code> or <code>export</code> inside an <code>if</code> conditional; they must appear outside of all blocks and functions.</p><h4 id="exporting-api-members" tabindex="-1"><a class="header-anchor" href="#exporting-api-members" aria-hidden="true">#</a> <code>export</code>ing API Members</h4><p>The <code>export</code> keyword is either put in front of a declaration, or used as an operator (of sorts) with a special list of bindings to export. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">var</span> awesome <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> bar <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Another way of expressing the same exports:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> awesome <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> awesome<span class="token punctuation">,</span> bar <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>These are all called <em>named exports</em>, as you are in effect exporting the name bindings of the variables/functions/etc.</p><p>Anything you don&#39;t <em>label</em> with <code>export</code> stays private inside the scope of the module. That is, although something like <code>var bar = ..</code> looks like it&#39;s declaring at the top-level global scope, the top-level scope is actually the module itself; there is no global scope in modules.</p><p><strong>Note:</strong> Modules <em>do</em> still have access to <code>window</code> and all the &quot;globals&quot; that hang off it, just not as lexical top-level scope. However, you really should stay away from the globals in your modules if at all possible.</p><p>You can also &quot;rename&quot; (aka alias) a module member during named export:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> bar <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>When this module is imported, only the <code>bar</code> member name is available to import; <code>foo</code> stays hidden inside the module.</p><p>Module exports are not just normal assignments of values or references, as you&#39;re accustomed to with the <code>=</code> assignment operator. Actually, when you export something, you&#39;re exporting a binding (kinda like a pointer) to that thing (variable, etc.).</p><p>Within your module, if you change the value of a variable you already exported a binding to, even if it&#39;s already been imported (see the next section), the imported binding will resolve to the current (updated) value.</p><p>Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> awesome <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> awesome <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// later</span>
awesome <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>When this module is imported, regardless of whether that&#39;s before or after the <code>awesome = 100</code> setting, once that assignment has happened, the imported binding resolves to the <code>100</code> value, not <code>42</code>.</p><p>That&#39;s because the binding is, in essence, a reference to, or a pointer to, the <code>awesome</code> variable itself, rather than a copy of its value. This is a mostly unprecedented concept for JS introduced with ES6 module bindings.</p><p>Though you can clearly use <code>export</code> multiple times inside a module&#39;s definition, ES6 definitely prefers the approach that a module has a single export, which is known as a <em>default export</em>. In the words of some members of the TC39 committee, you&#39;re &quot;rewarded with simpler <code>import</code> syntax&quot; if you follow that pattern, and conversely &quot;penalized&quot; with more verbose syntax if you don&#39;t.</p><p>A default export sets a particular exported binding to be the default when importing the module. The name of the binding is literally <code>default</code>. As you&#39;ll see later, when importing module bindings you can also rename them, as you commonly will with a default export.</p><p>There can only be one <code>default</code> per module definition. We&#39;ll cover <code>import</code> in the next section, and you&#39;ll see how the <code>import</code> syntax is more concise if the module has a default export.</p><p>There&#39;s a subtle nuance to default export syntax that you should pay close attention to. Compare these two snippets:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> foo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>And this one:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>In the first snippet, you are exporting a binding to the function expression value at that moment, <em>not</em> to the identifier <code>foo</code>. In other words, <code>export default ..</code> takes an expression. If you later assign <code>foo</code> to a different value inside your module, the module import still reveals the function originally exported, not the new value.</p><p>By the way, the first snippet could also have been written as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Warning:</strong> Although the <code>function foo..</code> part here is technically a function expression, for the purposes of the internal scope of the module, it&#39;s treated like a function declaration, in that the <code>foo</code> name is bound in the module&#39;s top-level scope (often called &quot;hoisting&quot;). The same is true for <code>export default class Foo..</code>. However, while you <em>can</em> do <code>export var foo = ..</code>, you currently cannot do <code>export default var foo = ..</code> (or <code>let</code> or <code>const</code>), in a frustrating case of inconsistency. At the time of this writing, there&#39;s already discussion of adding that capability in soon, post-ES6, for consistency sake.</p><p>Recall the second snippet again:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>In this version of the module export, the default export binding is actually to the <code>foo</code> identifier rather than its value, so you get the previously described binding behavior (i.e., if you later change <code>foo</code>&#39;s value, the value seen on the import side will also be updated).</p><p>Be very careful of this subtle gotcha in default export syntax, especially if your logic calls for export values to be updated. If you never plan to update a default export&#39;s value, <code>export default ..</code> is fine. If you do plan to update the value, you must use <code>export { .. as default }</code>. Either way, make sure to comment your code to explain your intent!</p><p>Because there can only be one <code>default</code> per module, you may be tempted to design your module with one default export of an object with all your API methods on it, such as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>That pattern seems to map closely to how a lot of developers have already structured their pre-ES6 modules, so it seems like a natural approach. Unfortunately, it has some downsides and is officially discouraged.</p><p>In particular, the JS engine cannot statically analyze the contents of a plain object, which means it cannot do some optimizations for static <code>import</code> performance. The advantage of having each member individually and explicitly exported is that the engine <em>can</em> do the static analysis and optimization.</p><p>If your API has more than one member already, it seems like these principles -- one default export per module, and all API members as named exports -- are in conflict, doesn&#39;t it? But you <em>can</em> have a single default export as well as other named exports; they are not mutually exclusive.</p><p>So, instead of this (discouraged) pattern:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

foo<span class="token punctuation">.</span><span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function-variable function">baz</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You can do:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Note:</strong> In this previous snippet, I used the name <code>foo</code> for the function that <code>default</code> labels. That <code>foo</code> name, however, is ignored for the purposes of export -- <code>default</code> is actually the exported name. When you import this default binding, you can give it whatever name you want, as you&#39;ll see in the next section.</p><p>Alternatively, some will prefer:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The effects of mixing default and named exports will be more clear when we cover <code>import</code> shortly. But essentially it means that the most concise default import form would only retrieve the <code>foo()</code> function. The user could additionally manually list <code>bar</code> and <code>baz</code> as named imports, if they want them.</p><p>You can probably imagine how tedious that&#39;s going to be for consumers of your module if you have lots of named export bindings. There is a wildcard import form where you import all of a module&#39;s exports within a single namespace object, but there&#39;s no way to wildcard import to top-level bindings.</p><p>Again, the ES6 module mechanism is intentionally designed to discourage modules with lots of exports; relatively speaking, it&#39;s desired that such approaches be a little more difficult, as a sort of social engineering to encourage simple module design in favor of large/complex module design.</p><p>I would probably recommend you not mix default export with named exports, especially if you have a large API and refactoring to separate modules isn&#39;t practical or desired. In that case, just use all named exports, and document that consumers of your module should probably use the <code>import * as ..</code> (namespace import, discussed in the next section) approach to bring the whole API in at once on a single namespace.</p><p>We mentioned this earlier, but let&#39;s come back to it in more detail. Other than the <code>export default ...</code> form that exports an expression value binding, all other export forms are exporting bindings to local identifiers. For those bindings, if you change the value of a variable inside a module after exporting, the external imported binding will access the updated value:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>

foo <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
bar <span class="token operator">=</span> <span class="token string">&quot;cool&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>When you import this module, the <code>default</code> and <code>bar</code> exports will be bound to the local variables <code>foo</code> and <code>bar</code>, meaning they will reveal the updated <code>10</code> and <code>&quot;cool&quot;</code> values. The values at time of export are irrelevant. The values at time of import are irrelevant. The bindings are live links, so all that matters is what the current value is when you access the binding.</p><p><strong>Warning:</strong> Two-way bindings are not allowed. If you import a <code>foo</code> from a module, and try to change the value of your imported <code>foo</code> variable, an error will be thrown! We&#39;ll revisit that in the next section.</p><p>You can also re-export another module&#39;s exports, such as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> <span class="token constant">FOO</span><span class="token punctuation">,</span> bar <span class="token keyword">as</span> <span class="token constant">BAR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Those forms are similar to just first importing from the <code>&quot;baz&quot;</code> module then listing its members explicitly for export from your module. However, in these forms, the members of the <code>&quot;baz&quot;</code> module are never imported to your module&#39;s local scope; they sort of pass through untouched.</p><h4 id="importing-api-members" tabindex="-1"><a class="header-anchor" href="#importing-api-members" aria-hidden="true">#</a> <code>import</code>ing API Members</h4><p>To import a module, unsurprisingly you use the <code>import</code> statement. Just as <code>export</code> has several nuanced variations, so does <code>import</code>, so spend plenty of time considering the following issues and experimenting with your options.</p><p>If you want to import certain specific named members of a module&#39;s API into your top-level scope, you use this syntax:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>Warning:</strong> The <code>{ .. }</code> syntax here may look like an object literal, or even an object destructuring syntax. However, its form is special just for modules, so be careful not to confuse it with other <code>{ .. }</code> patterns elsewhere.</p><p>The <code>&quot;foo&quot;</code> string is called a <em>module specifier</em>. Because the whole goal is statically analyzable syntax, the module specifier must be a string literal; it cannot be a variable holding the string value.</p><p>From the perspective of your ES6 code and the JS engine itself, the contents of this string literal are completely opaque and meaningless. The module loader will interpret this string as an instruction of where to find the desired module, either as a URL path or a local filesystem path.</p><p>The <code>foo</code>, <code>bar</code>, and <code>baz</code> identifiers listed must match named exports on the module&#39;s API (static analysis and error assertion apply). They are bound as top-level identifiers in your current scope:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>You can rename the bound identifiers imported, as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> theFooFunc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token function">theFooFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If the module has just a default export that you want to import and bind to an identifier, you can opt to skip the <code>{ .. }</code> surrounding syntax for that binding. The <code>import</code> in this preferred case gets the nicest and most concise of the <code>import</code> syntax forms:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// or:</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Note:</strong> As explained in the previous section, the <code>default</code> keyword in a module&#39;s <code>export</code> specifies a named export where the name is actually <code>default</code>, as is illustrated by the second more verbose syntax option. The renaming from <code>default</code> to, in this case, <code>foo</code>, is explicit in the latter syntax and is identical yet implicit in the former syntax.</p><p>You can also import a default export along with other named exports, if the module has such a definition. Recall this module definition from earlier:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>To import that module&#39;s default export and its two named exports:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token constant">FOOFN</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> bar<span class="token punctuation">,</span> baz <span class="token keyword">as</span> <span class="token constant">BAZ</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token constant">FOOFN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">BAZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The strongly suggested approach from ES6&#39;s module philosophy is that you only import the specific bindings from a module that you need. If a module provides 10 API methods, but you only need two of them, some believe it wasteful to bring in the entire set of API bindings.</p><p>One benefit, besides code being more explicit, is that narrow imports make static analysis and error detection (accidentally using the wrong binding name, for instance) more robust.</p><p>Of course, that&#39;s just the standard position influenced by ES6 design philosophy; there&#39;s nothing that requires adherence to that approach.</p><p>Many developers would be quick to point out that such approaches can be more tedious, requiring you to regularly revisit and update your <code>import</code> statement(s) each time you realize you need something else from a module. The trade-off is in exchange for convenience.</p><p>In that light, the preference might be to import everything from the module into a single namespace, rather than importing individual members, each directly into the scope. Fortunately, the <code>import</code> statement has a syntax variation that can support this style of module consumption, called <em>namespace import</em>.</p><p>Consider a <code>&quot;foo&quot;</code> module exported as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>You can import that entire API to a single module namespace binding:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> foo <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>x<span class="token punctuation">;</span>			<span class="token comment">// 42</span>
foo<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Note:</strong> The <code>* as ..</code> clause requires the <code>*</code> wildcard. In other words, you cannot do something like <code>import { bar, x } as foo from &quot;foo&quot;</code> to bring in only part of the API but still bind to the <code>foo</code> namespace. I would have liked something like that, but for ES6 it&#39;s all or nothing with the namespace import.</p><p>If the module you&#39;re importing with <code>* as ..</code> has a default export, it is named <code>default</code> in the namespace specified. You can additionally name the default import outside of the namespace binding, as a top-level identifier. Consider a <code>&quot;world&quot;</code> module exported as:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>And this <code>import</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foofn<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">as</span> hello <span class="token keyword">from</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>

<span class="token function">foofn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hello<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hello<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hello<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>While this syntax is valid, it can be rather confusing that one method of the module (the default export) is bound at the top-level of your scope, whereas the rest of the named exports (and one called <code>default</code>) are bound as properties on a differently named (<code>hello</code>) identifier namespace.</p><p>As I mentioned earlier, my suggestion would be to avoid designing your module exports in this way, to reduce the chances that your module&#39;s users will suffer these strange quirks.</p><p>All imported bindings are immutable and/or read-only. Consider the previous import; all of these subsequent assignment attempts will throw <code>TypeError</code>s:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foofn<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">as</span> hello <span class="token keyword">from</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>

foofn <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>			<span class="token comment">// (runtime) TypeError!</span>
hello<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>	<span class="token comment">// (runtime) TypeError!</span>
hello<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>		<span class="token comment">// (runtime) TypeError!</span>
hello<span class="token punctuation">.</span>baz <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>		<span class="token comment">// (runtime) TypeError!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Recall earlier in the &quot;<code>export</code>ing API Members&quot; section that we talked about how the <code>bar</code> and <code>baz</code> bindings are bound to the actual identifiers inside the <code>&quot;world&quot;</code> module. That means if the module changes those values, <code>hello.bar</code> and <code>hello.baz</code> now reference the updated values.</p><p>But the immutable/read-only nature of your local imported bindings enforces that you cannot change them from the imported bindings, hence the <code>TypeError</code>s. That&#39;s pretty important, because without those protections, your changes would end up affecting all other consumers of the module (remember: singleton), which could create some very surprising side effects!</p><p>Moreover, though a module <em>can</em> change its API members from the inside, you should be very cautious of intentionally designing your modules in that fashion. ES6 modules are <em>intended</em> to be static, so deviations from that principle should be rare and should be carefully and verbosely documented.</p><p><strong>Warning:</strong> There are module design philosophies where you actually intend to let a consumer change the value of a property on your API, or module APIs are designed to be &quot;extended&quot; by having other &quot;plug-ins&quot; add to the API namespace. As we just asserted, ES6 module APIs should be thought of and designed as static and unchangeable, which strongly restricts and discourages these alternative module design patterns. You can get around these limitations by exporting a plain object, which of course can then be changed at will. But be careful and think twice before going down that road.</p><p>Declarations that occur as a result of an <code>import</code> are &quot;hoisted&quot; (see the <em>Scope &amp; Closures</em> title of this series). Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>foo()</code> can run because not only did the static resolution of the <code>import ..</code> statement figure out what <code>foo</code> is during compilation, but it also &quot;hoisted&quot; the declaration to the top of the module&#39;s scope, thus making it available throughout the module.</p><p>Finally, the most basic form of the <code>import</code> looks like this:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This form does not actually import any of the module&#39;s bindings into your scope. It loads (if not already loaded), compiles (if not already compiled), and evaluates (if not already run) the <code>&quot;foo&quot;</code> module.</p><p>In general, that sort of import is probably not going to be terribly useful. There may be niche cases where a module&#39;s definition has side effects (such as assigning things to the <code>window</code>/global object). You could also envision using <code>import &quot;foo&quot;</code> as a sort of preload for a module that may be needed later.</p><h3 id="circular-module-dependency" tabindex="-1"><a class="header-anchor" href="#circular-module-dependency" aria-hidden="true">#</a> Circular Module Dependency</h3><p>A imports B. B imports A. How does this actually work?</p><p>I&#39;ll state off the bat that designing systems with intentional circular dependency is generally something I try to avoid. That having been said, I recognize there are reasons people do this and it can solve some sticky design situations.</p><p>Let&#39;s consider how ES6 handles this. First, module <code>&quot;A&quot;</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> bar <span class="token keyword">from</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">bar</span><span class="token punctuation">(</span> x <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Now, module <code>&quot;B&quot;</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span> y <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> y <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>These two functions, <code>foo(..)</code> and <code>bar(..)</code>, would work as standard function declarations if they were in the same scope, because the declarations are &quot;hoisted&quot; to the whole scope and thus available to each other regardless of authoring order.</p><p>With modules, you have declarations in entirely different scopes, so ES6 has to do extra work to help make these circular references work.</p><p>In a rough conceptual sense, this is how circular <code>import</code> dependencies are validated and resolved:</p><ul><li>If the <code>&quot;A&quot;</code> module is loaded first, the first step is to scan the file and analyze all the exports, so it can register all those bindings available for import. Then it processes the <code>import .. from &quot;B&quot;</code>, which signals that it needs to go fetch <code>&quot;B&quot;</code>.</li><li>Once the engine loads <code>&quot;B&quot;</code>, it does the same analysis of its export bindings. When it sees the <code>import .. from &quot;A&quot;</code>, it knows the API of <code>&quot;A&quot;</code> already, so it can verify the <code>import</code> is valid. Now that it knows the <code>&quot;B&quot;</code> API, it can also validate the <code>import .. from &quot;B&quot;</code> in the waiting <code>&quot;A&quot;</code> module.</li></ul><p>In essence, the mutual imports, along with the static verification that&#39;s done to validate both <code>import</code> statements, virtually composes the two separate module scopes (via the bindings), such that <code>foo(..)</code> can call <code>bar(..)</code> and vice versa. This is symmetric to if they had originally been declared in the same scope.</p><p>Now let&#39;s try using the two modules together. First, we&#39;ll try <code>foo(..)</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">25</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 11</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Or we can try <code>bar(..)</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> bar <span class="token keyword">from</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span> <span class="token number">25</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 11.5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>By the time either the <code>foo(25)</code> or <code>bar(25)</code> calls are executed, all the analysis/compilation of all modules has completed. That means <code>foo(..)</code> internally knows directly about <code>bar(..)</code> and <code>bar(..)</code> internally knows directly about <code>foo(..)</code>.</p><p>If all we need is to interact with <code>foo(..)</code>, then we only need to import the <code>&quot;foo&quot;</code> module. Likewise with <code>bar(..)</code> and the <code>&quot;bar&quot;</code> module.</p><p>Of course, we <em>can</em> import and use both of them if we want to:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bar <span class="token keyword">from</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">25</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 11</span>
<span class="token function">bar</span><span class="token punctuation">(</span> <span class="token number">25</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 11.5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The static loading semantics of the <code>import</code> statement mean that a <code>&quot;foo&quot;</code> and <code>&quot;bar&quot;</code> that mutually depend on each other via <code>import</code> will ensure that both are loaded, parsed, and compiled before either of them runs. So their circular dependency is statically resolved and this works as you&#39;d expect.</p><h3 id="module-loading" tabindex="-1"><a class="header-anchor" href="#module-loading" aria-hidden="true">#</a> Module Loading</h3><p>We asserted at the beginning of this &quot;Modules&quot; section that the <code>import</code> statement uses a separate mechanism, provided by the hosting environment (browser, Node.js, etc.), to actually resolve the module specifier string into some useful instruction for finding and loading the desired module. That mechanism is the system <em>Module Loader</em>.</p><p>The default module loader provided by the environment will interpret a module specifier as a URL if in the browser, and (generally) as a local filesystem path if on a server such as Node.js. The default behavior is to assume the loaded file is authored in the ES6 standard module format.</p><p>Moreover, you will be able to load a module into the browser via an HTML tag, similar to how current script programs are loaded. At the time of this writing, it&#39;s not fully clear if this tag will be <code>&lt;script type=&quot;module&quot;&gt;</code> or <code>&lt;module&gt;</code>. ES6 doesn&#39;t control that decision, but discussions in the appropriate standards bodies are already well along in parallel of ES6.</p><p>Whatever the tag looks like, you can be sure that under the covers it will use the default loader (or a customized one you&#39;ve pre-specified, as we&#39;ll discuss in the next section).</p><p>Just like the tag you&#39;ll use in markup, the module loader itself is not specified by ES6. It is a separate, parallel standard (http://whatwg.github.io/loader/) controlled currently by the WHATWG browser standards group.</p><p>At the time of this writing, the following discussions reflect an early pass at the API design, and things are likely to change.</p><h4 id="loading-modules-outside-of-modules" tabindex="-1"><a class="header-anchor" href="#loading-modules-outside-of-modules" aria-hidden="true">#</a> Loading Modules Outside of Modules</h4><p>One use for interacting directly with the module loader is if a non-module needs to load a module. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// normal script loaded in browser via `&lt;script&gt;`,</span>
<span class="token comment">// `import` is illegal here</span>

Reflect<span class="token punctuation">.</span>Loader<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">)</span> <span class="token comment">// returns a promise for `&quot;foo&quot;`</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The <code>Reflect.Loader.import(..)</code> utility imports the entire module onto the named parameter (as a namespace), just like the <code>import * as foo ..</code> namespace import we discussed earlier.</p><p><strong>Note:</strong> The <code>Reflect.Loader.import(..)</code> utility returns a promise that is fulfilled once the module is ready. To import multiple modules, you can compose promises from multiple <code>Reflect.Loader.import(..)</code> calls using <code>Promise.all([ .. ])</code>. For more information about Promises, see &quot;Promises&quot; in Chapter 4.</p><p>You can also use <code>Reflect.Loader.import(..)</code> in a real module to dynamically/conditionally load a module, where <code>import</code> itself would not work. You might, for instance, choose to load a module containing a polyfill for some ES7+ feature if a feature test reveals it&#39;s not defined by the current engine.</p><p>For performance reasons, you&#39;ll want to avoid dynamic loading whenever possible, as it hampers the ability of the JS engine to fire off early fetches from its static analysis.</p><h4 id="customized-loading" tabindex="-1"><a class="header-anchor" href="#customized-loading" aria-hidden="true">#</a> Customized Loading</h4><p>Another use for directly interacting with the module loader is if you want to customize its behavior through configuration or even redefinition.</p><p>At the time of this writing, there&#39;s a polyfill for the module loader API being developed (https://github.com/ModuleLoader/es6-module-loader). While details are scarce and highly subject to change, we can explore what possibilities may eventually land.</p><p>The <code>Reflect.Loader.import(..)</code> call may support a second argument for specifying various options to customize the import/load task. For example:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Reflect<span class="token punctuation">.</span>Loader<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/foo.js&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>It&#39;s also expected that a customization will be provided (through some means) for hooking into the process of loading a module, where a translation/transpilation could occur after load but before the engine compiles the module.</p><p>For example, you could load something that&#39;s not already an ES6-compliant module format (e.g., CoffeeScript, TypeScript, CommonJS, AMD). Your translation step could then convert it to an ES6-compliant module for the engine to then process.</p><h2 id="classes" tabindex="-1"><a class="header-anchor" href="#classes" aria-hidden="true">#</a> Classes</h2><p>From nearly the beginning of JavaScript, syntax and development patterns have all strived (read: struggled) to put on a facade of supporting class-oriented development. With things like <code>new</code> and <code>instanceof</code> and a <code>.constructor</code> property, who couldn&#39;t help but be teased that JS had classes hidden somewhere inside its prototype system?</p><p>Of course, JS &quot;classes&quot; aren&#39;t nearly the same as classical classes. The differences are well documented, so I won&#39;t belabor that point any further here.</p><p><strong>Note:</strong> To learn more about the patterns used in JS to fake &quot;classes,&quot; and an alternative view of prototypes called &quot;delegation,&quot; see the second half of the <em>this &amp; Object Prototypes</em> title of this series.</p><h3 id="class" tabindex="-1"><a class="header-anchor" href="#class" aria-hidden="true">#</a> <code>class</code></h3><p>Although JS&#39;s prototype mechanism doesn&#39;t work like traditional classes, that doesn&#39;t stop the strong tide of demand on the language to extend the syntactic sugar so that expressing &quot;classes&quot; looks more like real classes. Enter the ES6 <code>class</code> keyword and its associated mechanism.</p><p>This feature is the result of a highly contentious and drawn-out debate, and represents a smaller subset compromise from several strongly opposed views on how to approach JS classes. Most developers who want full classes in JS will find parts of the new syntax quite inviting, but will find important bits still missing. Don&#39;t worry, though. TC39 is already working on additional features to augment classes in the post-ES6 timeframe.</p><p>At the heart of the new ES6 class mechanism is the <code>class</code> keyword, which identifies a <em>block</em> where the contents define the members of a function&#39;s prototype. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> a<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> b<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">gimmeXY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Some things to note:</p><ul><li><code>class Foo</code> implies creating a (special) function of the name <code>Foo</code>, much like you did pre-ES6.</li><li><code>constructor(..)</code> identifies the signature of that <code>Foo(..)</code> function, as well as its body contents.</li><li>Class methods use the same &quot;concise method&quot; syntax available to object literals, as discussed in Chapter 2. This also includes the concise generator form as discussed earlier in this chapter, as well as the ES5 getter/setter syntax. However, class methods are non-enumerable whereas object methods are by default enumerable.</li><li>Unlike object literals, there are no commas separating members in a <code>class</code> body! In fact, they&#39;re not even allowed.</li></ul><p>The <code>class</code> syntax definition in the previous snippet can be roughly thought of as this pre-ES6 equivalent, which probably will look fairly familiar to those who&#39;ve done prototype-style coding before:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> a<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">gimmeXY</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>In either the pre-ES6 form or the new ES6 <code>class</code> form, this &quot;class&quot; can now be instantiated and used just as you&#39;d expect:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

f<span class="token punctuation">.</span>x<span class="token punctuation">;</span>						<span class="token comment">// 5</span>
f<span class="token punctuation">.</span>y<span class="token punctuation">;</span>						<span class="token comment">// 15</span>
f<span class="token punctuation">.</span><span class="token function">gimmeXY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 75</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Caution! Though <code>class Foo</code> seems much like <code>function Foo()</code>, there are important differences:</p><ul><li>A <code>Foo(..)</code> call of <code>class Foo</code> <em>must</em> be made with <code>new</code>, as the pre-ES6 option of <code>Foo.call( obj )</code> will <em>not</em> work.</li><li>While <code>function Foo</code> is &quot;hoisted&quot; (see the <em>Scope &amp; Closures</em> title of this series), <code>class Foo</code> is not; the <code>extends ..</code> clause specifies an expression that cannot be &quot;hoisted.&quot; So, you must declare a <code>class</code> before you can instantiate it.</li><li><code>class Foo</code> in the top global scope creates a lexical <code>Foo</code> identifier in that scope, but unlike <code>function Foo</code> does not create a global object property of that name.</li></ul><p>The established <code>instanceof</code> operator still works with ES6 classes, because <code>class</code> just creates a constructor function of the same name. However, ES6 introduces a way to customize how <code>instanceof</code> works, using <code>Symbol.hasInstance</code> (see &quot;Well-Known Symbols&quot; in Chapter 7).</p><p>Another way of thinking about <code>class</code>, which I find more convenient, is as a <em>macro</em> that is used to automatically populate a <code>prototype</code> object. Optionally, it also wires up the <code>[[Prototype]]</code> relationship if using <code>extends</code> (see the next section).</p><p>An ES6 <code>class</code> isn&#39;t really an entity itself, but a meta concept that wraps around other concrete entities, such as functions and properties, and ties them together.</p><p><strong>Tip:</strong> In addition to the declaration form, a <code>class</code> can also be an expression, as in: <code>var x = class Y { .. }</code>. This is primarily useful for passing a class definition (technically, the constructor itself) as a function argument or assigning it to an object property.</p><h3 id="extends-and-super" tabindex="-1"><a class="header-anchor" href="#extends-and-super" aria-hidden="true">#</a> <code>extends</code> and <code>super</code></h3><p>ES6 classes also have syntactic sugar for establishing the <code>[[Prototype]]</code> delegation link between two function prototypes -- commonly mislabeled &quot;inheritance&quot; or confusingly labeled &quot;prototype inheritance&quot; -- using the class-oriented familiar terminology <code>extends</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">=</span> c<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">gimmeXYZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">gimmeXY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">25</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

b<span class="token punctuation">.</span>x<span class="token punctuation">;</span>						<span class="token comment">// 5</span>
b<span class="token punctuation">.</span>y<span class="token punctuation">;</span>						<span class="token comment">// 15</span>
b<span class="token punctuation">.</span>z<span class="token punctuation">;</span>						<span class="token comment">// 25</span>
b<span class="token punctuation">.</span><span class="token function">gimmeXYZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 1875</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>A significant new addition is <code>super</code>, which is actually something not directly possible pre-ES6 (without some unfortunate hack trade-offs). In the constructor, <code>super</code> automatically refers to the &quot;parent constructor,&quot; which in the previous example is <code>Foo(..)</code>. In a method, it refers to the &quot;parent object,&quot; such that you can then make a property/method access off it, such as <code>super.gimmeXY()</code>.</p><p><code>Bar extends Foo</code> of course means to link the <code>[[Prototype]]</code> of <code>Bar.prototype</code> to <code>Foo.prototype</code>. So, <code>super</code> in a method like <code>gimmeXYZ()</code> specifically means <code>Foo.prototype</code>, whereas <code>super</code> means <code>Foo</code> when used in the <code>Bar</code> constructor.</p><p><strong>Note:</strong> <code>super</code> is not limited to <code>class</code> declarations. It also works in object literals, in much the same way we&#39;re discussing here. See &quot;Object <code>super</code>&quot; in Chapter 2 for more information.</p><h4 id="there-be-super-dragons" tabindex="-1"><a class="header-anchor" href="#there-be-super-dragons" aria-hidden="true">#</a> There Be <code>super</code> Dragons</h4><p>It is not insignificant to note that <code>super</code> behaves differently depending on where it appears. In fairness, most of the time, that won&#39;t be a problem. But surprises await if you deviate from a narrow norm.</p><p>There may be cases where in the constructor you would want to reference the <code>Foo.prototype</code>, such as to directly access one of its properties/methods. However, <code>super</code> in the constructor cannot be used in that way; <code>super.prototype</code> will not work. <code>super(..)</code> means roughly to call <code>new Foo(..)</code>, but isn&#39;t actually a usable reference to <code>Foo</code> itself.</p><p>Symmetrically, you may want to reference the <code>Foo(..)</code> function from inside a non-constructor method. <code>super.constructor</code> will point at <code>Foo(..)</code> the function, but beware that this function can <em>only</em> be invoked with <code>new</code>. <code>new super.constructor(..)</code> would be valid, but it wouldn&#39;t be terribly useful in most cases, because you can&#39;t make that call use or reference the current <code>this</code> object context, which is likely what you&#39;d want.</p><p>Also, <code>super</code> looks like it might be driven by a function&#39;s context just like <code>this</code> -- that is, that they&#39;d both be dynamically bound. However, <code>super</code> is not dynamic like <code>this</code> is. When a constructor or method makes a <code>super</code> reference inside it at declaration time (in the <code>class</code> body), that <code>super</code> is statically bound to that specific class hierarchy, and cannot be overridden (at least in ES6).</p><p>What does that mean? It means that if you&#39;re in the habit of taking a method from one &quot;class&quot; and &quot;borrowing&quot; it for another class by overriding its <code>this</code>, say with <code>call(..)</code> or <code>apply(..)</code>, that may very well create surprises if the method you&#39;re borrowing has a <code>super</code> in it. Consider this class hierarchy:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ParentA</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;ParentA:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ParentB</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;ParentB:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span> <span class="token keyword">extends</span> <span class="token class-name">ParentA</span> <span class="token punctuation">{</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;ChildA:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ChildB</span> <span class="token keyword">extends</span> <span class="token class-name">ParentB</span> <span class="token punctuation">{</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;ChildB:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// ParentA: a</span>
							<span class="token comment">// ChildA: a</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// ParentB: b</span>
b<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// ChildB: b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>All seems fairly natural and expected in this previous snippet. However, if you try to borrow <code>b.foo()</code> and use it in the context of <code>a</code> -- by virtue of dynamic <code>this</code> binding, such borrowing is quite common and used in many different ways, including mixins most notably -- you may find this result an ugly surprise:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// borrow `b.foo()` to use in `a` context</span>
b<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// ParentB: a</span>
							<span class="token comment">// ChildB: a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>As you can see, the <code>this.id</code> reference was dynamically rebound so that <code>: a</code> is reported in both cases instead of <code>: b</code>. But <code>b.foo()</code>&#39;s <code>super.foo()</code> reference wasn&#39;t dynamically rebound, so it still reported <code>ParentB</code> instead of the expected <code>ParentA</code>.</p><p>Because <code>b.foo()</code> references <code>super</code>, it is statically bound to the <code>ChildB</code>/<code>ParentB</code> hierarchy and cannot be used against the <code>ChildA</code>/<code>ParentA</code> hierarchy. There is no ES6 solution to this limitation.</p><p><code>super</code> seems to work intuitively if you have a static class hierarchy with no cross-pollination. But in all fairness, one of the main benefits of doing <code>this</code>-aware coding is exactly that sort of flexibility. Simply, <code>class</code> + <code>super</code> requires you to avoid such techniques.</p><p>The choice boils down to narrowing your object design to these static hierarchies -- <code>class</code>, <code>extends</code>, and <code>super</code> will be quite nice -- or dropping all attempts to &quot;fake&quot; classes and instead embrace dynamic and flexible, classless objects and <code>[[Prototype]]</code> delegation (see the <em>this &amp; Object Prototypes</em> title of this series).</p><h4 id="subclass-constructor" tabindex="-1"><a class="header-anchor" href="#subclass-constructor" aria-hidden="true">#</a> Subclass Constructor</h4><p>Constructors are not required for classes or subclasses; a default constructor is substituted in both cases if omitted. However, the default substituted constructor is different for a direct class versus an extended class.</p><p>Specifically, the default subclass constructor automatically calls the parent constructor, and passes along any arguments. In other words, you could think of the default subclass constructor sort of like this:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This is an important detail to note. Not all class languages have the subclass constructor automatically call the parent constructor. C++ does, but Java does not. But more importantly, in pre-ES6 classes, such automatic &quot;parent constructor&quot; calling does not happen. Be careful when converting to ES6 <code>class</code> if you&#39;ve been relying on such calls <em>not</em> happening.</p><p>Another perhaps surprising deviation/limitation of ES6 subclass constructors: in a constructor of a subclass, you cannot access <code>this</code> until <code>super(..)</code> has been called. The reason is nuanced and complicated, but it boils down to the fact that the parent constructor is actually the one creating/initializing your instance&#39;s <code>this</code>. Pre-ES6, it works oppositely; the <code>this</code> object is created by the &quot;subclass constructor,&quot; and then you call a &quot;parent constructor&quot; with the context of the &quot;subclass&quot; <code>this</code>.</p><p>Let&#39;s illustrate. This works pre-ES6:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token function">Foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// `Bar` &quot;extends&quot; `Foo`</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>But this ES6 equivalent is not allowed:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>			<span class="token comment">// not allowed before `super()`</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// to fix swap these two statements</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>In this case, the fix is simple. Just swap the two statements in the subclass <code>Bar</code> constructor. However, if you&#39;ve been relying pre-ES6 on being able to skip calling the &quot;parent constructor,&quot; beware because that won&#39;t be allowed anymore.</p><h4 id="extending-natives" tabindex="-1"><a class="header-anchor" href="#extending-natives" aria-hidden="true">#</a> <code>extend</code>ing Natives</h4><p>One of the most heralded benefits to the new <code>class</code> and <code>extend</code> design is the ability to (finally!) subclass the built-in natives, like <code>Array</code>. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCoolArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">{</span>
	<span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCoolArray</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>					<span class="token comment">// 3</span>
a<span class="token punctuation">;</span>							<span class="token comment">// [1,2,3]</span>

a<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// 1</span>
a<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Prior to ES6, a fake &quot;subclass&quot; of <code>Array</code> using manual object creation and linking to <code>Array.prototype</code> only partially worked. It missed out on the special behaviors of a real array, such as the automatically updating <code>length</code> property. ES6 subclasses should fully work with &quot;inherited&quot; and augmented behaviors as expected!</p><p>Another common pre-ES6 &quot;subclass&quot; limitation is with the <code>Error</code> object, in creating custom error &quot;subclasses.&quot; When genuine <code>Error</code> objects are created, they automatically capture special <code>stack</code> information, including the line number and file where the error is created. Pre-ES6 custom error &quot;subclasses&quot; have no such special behavior, which severely limits their usefulness.</p><p>ES6 to the rescue:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Oops</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>oops <span class="token operator">=</span> reason<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// later:</span>
<span class="token keyword">var</span> ouch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Oops</span><span class="token punctuation">(</span> <span class="token string">&quot;I messed up!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> ouch<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The <code>ouch</code> custom error object in this previous snippet will behave like any other genuine error object, including capturing <code>stack</code>. That&#39;s a big improvement!</p><h3 id="new-target" tabindex="-1"><a class="header-anchor" href="#new-target" aria-hidden="true">#</a> <code>new.target</code></h3><p>ES6 introduces a new concept called a <em>meta property</em> (see Chapter 7), in the form of <code>new.target</code>.</p><p>If that looks strange, it is; pairing a keyword with a <code>.</code> and a property name is definitely an out-of-the-ordinary pattern for JS.</p><p><code>new.target</code> is a new &quot;magical&quot; value available in all functions, though in normal functions it will always be <code>undefined</code>. In any constructor, <code>new.target</code> always points at the constructor that <code>new</code> actually directly invoked, even if the constructor is in a parent class and was delegated to by a <code>super(..)</code> call from a child constructor. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Foo: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Bar: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;baz: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Foo: Foo</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Foo: Bar   &lt;-- respects the `new` call-site</span>
<span class="token comment">// Bar: Bar</span>

b<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// baz: undefined</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>The <code>new.target</code> meta property doesn&#39;t have much purpose in class constructors, except accessing a static property/method (see the next section).</p><p>If <code>new.target</code> is <code>undefined</code>, you know the function was not called with <code>new</code>. You can then force a <code>new</code> invocation if that&#39;s necessary.</p><h3 id="static" tabindex="-1"><a class="header-anchor" href="#static" aria-hidden="true">#</a> <code>static</code></h3><p>When a subclass <code>Bar</code> extends a parent class <code>Foo</code>, we already observed that <code>Bar.prototype</code> is <code>[[Prototype]]</code>-linked to <code>Foo.prototype</code>. But additionally, <code>Bar()</code> is <code>[[Prototype]]</code>-linked to <code>Foo()</code>. That part may not have such an obvious reasoning.</p><p>However, it&#39;s quite useful in the case where you declare <code>static</code> methods (not just properties) for a class, as these are added directly to that class&#39;s function object, not to the function object&#39;s <code>prototype</code> object. Consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;cool&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token function">wow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;wow&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token function">awesome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;awesome&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">neat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">wow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;neat&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Foo<span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// &quot;cool&quot;</span>
Bar<span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// &quot;cool&quot;</span>
Bar<span class="token punctuation">.</span><span class="token function">awesome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// &quot;cool&quot;</span>
							<span class="token comment">// &quot;awesome&quot;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">neat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">// &quot;wow&quot;</span>
							<span class="token comment">// &quot;neat&quot;</span>

b<span class="token punctuation">.</span>awesome<span class="token punctuation">;</span>					<span class="token comment">// undefined</span>
b<span class="token punctuation">.</span>cool<span class="token punctuation">;</span>						<span class="token comment">// undefined</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Be careful not to get confused that <code>static</code> members are on the class&#39;s prototype chain. They&#39;re actually on the dual/parallel chain between the function constructors.</p><h4 id="symbol-species-constructor-getter" tabindex="-1"><a class="header-anchor" href="#symbol-species-constructor-getter" aria-hidden="true">#</a> <code>Symbol.species</code> Constructor Getter</h4><p>One place where <code>static</code> can be useful is in setting the <code>Symbol.species</code> getter (known internally in the specification as <code>@@species</code>) for a derived (child) class. This capability allows a child class to signal to a parent class what constructor should be used -- when not intending the child class&#39;s constructor itself -- if any parent class method needs to vend a new instance.</p><p>For example, many methods on <code>Array</code> create and return a new <code>Array</code> instance. If you define a derived class from <code>Array</code>, but you want those methods to continue to vend actual <code>Array</code> instances instead of from your derived class, this works:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCoolArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">{</span>
	<span class="token comment">// force `species` to be parent constructor</span>
	<span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>species<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Array<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCoolArray</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token keyword">instanceof</span> <span class="token class-name">MyCoolArray</span><span class="token punctuation">;</span>	<span class="token comment">// false</span>
b <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">;</span>			<span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>To illustrate how a parent class method can use a child&#39;s species declaration somewhat like <code>Array#map(..)</code> is doing, consider:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token comment">// defer `species` to derived constructor</span>
	<span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>species<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>constructor</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>species<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
	<span class="token comment">// force `species` to be parent constructor</span>
	<span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>species<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Foo<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span>					<span class="token comment">// true</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
y <span class="token keyword">instanceof</span> <span class="token class-name">Bar</span><span class="token punctuation">;</span>					<span class="token comment">// false</span>
y <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span>					<span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>The parent class <code>Symbol.species</code> does <code>return this</code> to defer to any derived class, as you&#39;d normally expect. <code>Bar</code> then overrides to manually declare <code>Foo</code> to be used for such instance creation. Of course, a derived class can still vend instances of itself using <code>new this.constructor(..)</code>.</p><h2 id="review" tabindex="-1"><a class="header-anchor" href="#review" aria-hidden="true">#</a> Review</h2><p>ES6 introduces several new features that aid in code organization:</p><ul><li>Iterators provide sequential access to data or operations. They can be consumed by new language features like <code>for..of</code> and <code>...</code>.</li><li>Generators are locally pause/resume capable functions controlled by an iterator. They can be used to programmatically (and interactively, through <code>yield</code>/<code>next(..)</code> message passing) <em>generate</em> values to be consumed via iteration.</li><li>Modules allow private encapsulation of implementation details with a publicly exported API. Module definitions are file-based, singleton instances, and statically resolved at compile time.</li><li>Classes provide cleaner syntax around prototype-based coding. The addition of <code>super</code> also solves tricky issues with relative references in the <code>[[Prototype]]</code> chain.</li></ul><p>These new tools should be your first stop when trying to improve the architecture of your JS projects by embracing ES6.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/us-fe/ebooks/edit/master/docs/en/you-dont-know-js-v1/es6-beyond/ch3.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yanqi.zyq@antfin.com">yanqi</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="us-fe/ebooks" repoId="R_kgDOHQs-GA" category="Announcements" categoryId="DIC_kwDOHQs-GM4CO312" lang="en" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/ebooks/assets/app.a957722f.js" defer></script>
  </body>
</html>
